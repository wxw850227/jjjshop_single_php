import{f as e,c as a,d as l,r as o,p as t,b as i,e as r,i as d,E as s,k as p,s as n,v as m,j as u,t as c}from"./element-plus-1acdbba0.js";import{r as h}from"./request-55d87c89.js";import{_ as f,d as _}from"./index-660c53aa.js";import{o as g,S as b,R as w,a as V,O as x,V as v,_ as y,c as C,X as D,ad as k}from"./@vue-5f6096d8.js";import"./lodash-es-493ac664.js";import"./async-validator-cf877c1f.js";import"./@vueuse-9798be2d.js";import"./dayjs-342c85a3.js";import"./call-bind-0966096f.js";import"./get-intrinsic-ccd8a43d.js";import"./has-symbols-456daba2.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-e5d54f4f.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./axios-85bcd05e.js";import"./qs-9a0be292.js";import"./side-channel-7d553c0c.js";import"./object-inspect-1e1e9601.js";import"./vue-router-0438cf31.js";import"./pinia-a7eba4b6.js";import"./vue-demi-71ba0ef2.js";let S={shopList:(e,a)=>h._post("/admin/shop/index",e,a),addShop:(e,a)=>h._post("/admin/shop/add",e,a),editShop:(e,a)=>h._post("/admin/shop/edit",e,a),updateStatus:(e,a)=>h._post("/admin/shop/updateStatus",e,a),storeEnter:(e,a)=>h._post("/admin/shop/enter",e,a),deleteShop:(e,a)=>h._post("/admin/shop/delete",e,a),updateWxStatus:(e,a)=>h._post("/admin/shop/updateWxStatus",e,a)};const j={data(){return{form:{no_expire:!1,weixin_service:!1},formLabelWidth:"120px",dialogVisible:!1,loading:!1,rules:{app_name:[{validator:(e,a,l)=>a?this.$filter.isAllSpace(a)?l(new Error("不能全是空格")):void l():l(new Error("请输入商城名称")),required:!0,trigger:"blur"}],user_name:[{validator:(e,a,l)=>this.$filter.replaceSpace(a)?this.$filter.hasSpace(a)?l(new Error("不能包含空格")):void l():l(new Error("商家账户名")),required:!0,trigger:"blur"}],password:[{validator:(e,a,l)=>{if(a){if(this.$filter.hasSpace(a))return l(new Error("不能包含空格"));if(a.length<6)return l(new Error("长度不能小于6位"));l()}else l()},trigger:"change"}],password_confirm:[{validator:(e,a,l)=>{this.form.password&&a!==this.form.password?l(new Error("确认密码不一致")):l()},trigger:"blur"}],expire_time_text:[{validator:(e,a,l)=>{this.form.no_expire||a?l():l(new Error("请输入过期时间"))},required:!0,trigger:"blur"}]}}},props:["open_edit","curModel"],created(){this.dialogVisible=this.open_edit,this.form=this.curModel},methods:{addClick(){let a=this,l=this.form;a.$refs.form.validate((o=>{o&&(a.loading=!0,S.editShop(l,!0).then((l=>{a.loading=!1,e({message:"恭喜你，修改成功",type:"success"}),a.dialogFormVisible(!0)})).catch((e=>{a.loading=!1})))}))},dialogFormVisible(e){e?this.$emit("closeDialog",{type:"success",openDialog:!1}):this.$emit("closeDialog",{type:"error",openDialog:!1})}}},E=V("div",{style:{height:"0",overflow:"hidden"}},[V("input",{type:"password"})],-1),U=V("p",{class:"gray"},"注：商家后台用户名",-1),L=V("p",{class:"gray"},"注：商家后台用户密码",-1),W={class:"dialog-footer"};const M=f(j,[["render",function(e,s,p,n,m,u){const c=a,h=l,f=o,_=t,y=i,C=r,D=d;return g(),b(D,{title:"编辑小程序商城",modelValue:m.dialogVisible,"onUpdate:modelValue":s[8]||(s[8]=e=>m.dialogVisible=e),onClose:u.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:w((()=>[V("div",W,[x(C,{onClick:u.dialogFormVisible},{default:w((()=>[v("取 消")])),_:1},8,["onClick"]),x(C,{type:"primary",onClick:s[7]||(s[7]=e=>u.addClick()),loading:m.loading},{default:w((()=>[v("确 定")])),_:1},8,["loading"])])])),default:w((()=>[x(y,{model:m.form,ref:"form",rules:m.rules},{default:w((()=>[E,x(h,{label:"商城名称","label-width":m.formLabelWidth,prop:"app_name"},{default:w((()=>[x(c,{modelValue:m.form.app_name,"onUpdate:modelValue":s[0]||(s[0]=e=>m.form.app_name=e),autocomplete:"off",placeholder:"请输入商城名称"},null,8,["modelValue"])])),_:1},8,["label-width"]),x(h,{label:"过期时间","label-width":m.formLabelWidth,prop:"expire_time_text"},{default:w((()=>[x(f,{modelValue:m.form.expire_time_text,"onUpdate:modelValue":s[1]||(s[1]=e=>m.form.expire_time_text=e),type:"date",placeholder:"过期时间","value-format":"YYYY-MM-DD",disabled:m.form.no_expire},null,8,["modelValue","disabled"]),x(_,{modelValue:m.form.no_expire,"onUpdate:modelValue":s[2]||(s[2]=e=>m.form.no_expire=e),class:"pl16"},{default:w((()=>[v("永不过期")])),_:1},8,["modelValue"])])),_:1},8,["label-width"]),x(h,{label:"商家账户名","label-width":m.formLabelWidth,prop:"user_name"},{default:w((()=>[x(c,{modelValue:m.form.user_name,"onUpdate:modelValue":s[3]||(s[3]=e=>m.form.user_name=e),autocomplete:"off",placeholder:"请输入商家账户名"},null,8,["modelValue"]),U])),_:1},8,["label-width"]),x(h,{label:"商家账户密码","label-width":m.formLabelWidth,prop:"password"},{default:w((()=>[x(c,{type:"password",modelValue:m.form.password,"onUpdate:modelValue":s[4]||(s[4]=e=>m.form.password=e),autocomplete:"off",placeholder:"请输入密码"},null,8,["modelValue"]),L])),_:1},8,["label-width"]),x(h,{label:"确认密码","label-width":m.formLabelWidth,prop:"password_confirm"},{default:w((()=>[x(c,{type:"password",modelValue:m.form.password_confirm,"onUpdate:modelValue":s[5]||(s[5]=e=>m.form.password_confirm=e),autocomplete:"off",placeholder:"请输入确认密码"},null,8,["modelValue"])])),_:1},8,["label-width"]),x(h,{label:"微信服务商支付","label-width":m.formLabelWidth,prop:"weixin_service"},{default:w((()=>[x(_,{modelValue:m.form.weixin_service,"onUpdate:modelValue":s[6]||(s[6]=e=>m.form.weixin_service=e)},{default:w((()=>[v("开启")])),_:1},8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"])}]]),$={data(){return{form:{no_expire:!1,weixin_service:!1},formLabelWidth:"120px",dialogVisible:!1,loading:!1,rules:{app_name:[{validator:(e,a,l)=>a?this.$filter.isAllSpace(a)?l(new Error("不能全是空格")):void l():l(new Error("请输入商城名称")),required:!0,trigger:"blur"}],user_name:[{validator:(e,a,l)=>this.$filter.replaceSpace(a)?this.$filter.hasSpace(a)?l(new Error("不能包含空格")):void l():l(new Error("商家账户名")),required:!0,trigger:"blur"}],password:[{validator:(e,a,l)=>{if(a){if(this.$filter.hasSpace(a))return l(new Error("不能包含空格"));if(a.length<6)return l(new Error("长度不能小于6位"));l()}else l(new Error("请输入密码"))},required:!0,trigger:"change"}],password_confirm:[{validator:(e,a,l)=>{a?a!==this.form.password?l(new Error("确认密码不一致")):l():l(new Error("请填写确认密码"))},required:!0,trigger:"blur"}],expire_time:[{validator:(e,a,l)=>{this.form.no_expire||a?l():l(new Error("请输入过期时间"))},required:!0,trigger:"blur"}]}}},props:["open_add"],created(){this.dialogVisible=this.open_add},methods:{addClick(){let a=this,l=this.form;a.$refs.form.validate((o=>{o&&(a.loading=!0,S.addShop(l,!0).then((l=>{a.loading=!1,1==l.code&&(e({message:"恭喜你，添加成功",type:"success"}),a.dialogFormVisible(!0))})).catch((e=>{a.loading=!1})))}))},dialogFormVisible(e){e?this.$emit("closeDialog",{type:"success",openDialog:!1}):this.$emit("closeDialog",{type:"error",openDialog:!1})}}},z=V("div",{style:{height:"0",overflow:"hidden"}},[V("input",{type:"password"})],-1),F=V("p",{class:"gray"},"注：商家后台用户名",-1),q=V("p",{class:"gray"},"注：商家后台用户密码",-1),Y={class:"dialog-footer"};const A={class:"common-level-rail"},P={class:"product-content"},N={class:"table-wrap"},B={class:"pagination"};const T=f({components:{Edit:M,Add:f($,[["render",function(e,s,p,n,m,u){const c=a,h=l,f=o,_=t,y=i,C=r,D=d;return g(),b(D,{title:"新增小程序商城",modelValue:m.dialogVisible,"onUpdate:modelValue":s[8]||(s[8]=e=>m.dialogVisible=e),onClose:u.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:w((()=>[V("div",Y,[x(C,{onClick:u.dialogFormVisible},{default:w((()=>[v("取 消")])),_:1},8,["onClick"]),x(C,{type:"primary",onClick:s[7]||(s[7]=e=>u.addClick()),loading:m.loading},{default:w((()=>[v("确 定")])),_:1},8,["loading"])])])),default:w((()=>[x(y,{model:m.form,ref:"form",rules:m.rules},{default:w((()=>[z,x(h,{label:"商城名称","label-width":m.formLabelWidth,prop:"app_name"},{default:w((()=>[x(c,{modelValue:m.form.app_name,"onUpdate:modelValue":s[0]||(s[0]=e=>m.form.app_name=e),autocomplete:"off",placeholder:"请输入商城名称"},null,8,["modelValue"])])),_:1},8,["label-width"]),x(h,{label:"过期时间","label-width":m.formLabelWidth,prop:"expire_time"},{default:w((()=>[x(f,{modelValue:m.form.expire_time,"onUpdate:modelValue":s[1]||(s[1]=e=>m.form.expire_time=e),type:"date",placeholder:"过期时间","value-format":"YYYY-MM-DD",disabled:m.form.no_expire},null,8,["modelValue","disabled"]),x(_,{modelValue:m.form.no_expire,"onUpdate:modelValue":s[2]||(s[2]=e=>m.form.no_expire=e),class:"pl16"},{default:w((()=>[v("永不过期")])),_:1},8,["modelValue"])])),_:1},8,["label-width"]),x(h,{label:"商家账户名","label-width":m.formLabelWidth,prop:"user_name"},{default:w((()=>[x(c,{modelValue:m.form.user_name,"onUpdate:modelValue":s[3]||(s[3]=e=>m.form.user_name=e),autocomplete:"off",placeholder:"请输入商家账户名"},null,8,["modelValue"]),F])),_:1},8,["label-width"]),x(h,{label:"商家账户密码","label-width":m.formLabelWidth,prop:"password"},{default:w((()=>[x(c,{type:"password",modelValue:m.form.password,"onUpdate:modelValue":s[4]||(s[4]=e=>m.form.password=e),autocomplete:"off",placeholder:"请输入密码"},null,8,["modelValue"]),q])),_:1},8,["label-width"]),x(h,{label:"确认密码","label-width":m.formLabelWidth,prop:"password_confirm"},{default:w((()=>[x(c,{type:"password",modelValue:m.form.password_confirm,"onUpdate:modelValue":s[5]||(s[5]=e=>m.form.password_confirm=e),autocomplete:"off",placeholder:"请输入确认密码"},null,8,["modelValue"])])),_:1},8,["label-width"]),x(h,{label:"微信服务商支付","label-width":m.formLabelWidth,prop:"weixin_service"},{default:w((()=>[x(_,{modelValue:m.form.weixin_service,"onUpdate:modelValue":s[6]||(s[6]=e=>m.form.weixin_service=e)},{default:w((()=>[v("开启")])),_:1},8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"])}]])},data:()=>({loading:!0,tableData:[],pageSize:15,totalDataNumber:0,curPage:1,open_add:!1,open_edit:!1,curModel:{}}),created(){this.getData()},methods:{targetLinkAddress:()=>`https://${window.location.hostname}/shop/#/login`,handleCurrentChange(e){let a=this;a.curPage=e,a.loading=!0,a.getData()},handleSizeChange(e){this.curPage=1,this.pageSize=e,this.getData()},getData(){let e=this;S.shopList({page:e.curPage,list_rows:e.pageSize},!0).then((a=>{e.loading=!1,e.tableData=a.data.list.data,e.totalDataNumber=a.data.list.total,e.tableData.forEach((function(e){e.is_recycle=0===e.is_recycle,e.weixin_service=1===e.weixin_service}))})).catch((e=>{}))},addClick(){this.open_add=!0},editClick(e){this.open_edit=!0,this.curModel=_(e),0==this.curModel.expire_time?(this.curModel.expire_time_text="",this.curModel.no_expire=!0):this.curModel.no_expire=!1},closeDialogFunc(e,a){"add"==a&&(this.open_add=e.openDialog,"success"==e.type&&this.getData()),"edit"==a&&(this.open_edit=e.openDialog,"success"==e.type&&this.getData())},statusChange:function(e,a){let l=this;l.loading=!0,S.updateStatus({app_id:a.app_id},!0).then((o=>{l.loading=!1,a.is_recycle=e})).catch((o=>{l.loading=!1,a.is_recycle=!e}))},wxStatusChange:function(e,a){let l=this;l.loading=!0,S.updateWxStatus({app_id:a.app_id},!0).then((o=>{l.loading=!1,a.weixin_service=e})).catch((o=>{l.loading=!1,a.weixin_service=!e}))},deleteClick(a){let l=this;s.confirm("删除后不可恢复，确认删除该记录吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{l.loading=!0,S.deleteShop({app_id:a.app_id},!0).then((a=>{l.loading=!1,1==a.code&&(e({message:a.msg,type:"success"}),l.getData())})).catch((e=>{l.loading=!1}))})).catch((()=>{}))},storeEnter(e){S.storeEnter({app_id:e},!0).then((e=>{})).catch((e=>{}))}}},[["render",function(e,a,l,o,i,d){const s=r,h=u,f=t,_=c,S=p,j=k("Add"),E=k("Edit"),U=n,L=m;return y((g(),C("div",null,[V("div",A,[x(s,{type:"primary",onClick:d.addClick},{default:w((()=>[v("添加商城")])),_:1},8,["onClick"])]),V("div",P,[V("div",N,[V("div",null,[y((g(),b(S,{data:i.tableData,style:{width:"100%"},"row-key":"access_id",border:"","default-expand-all":""},{default:w((()=>[x(h,{prop:"app_id",label:"商城ID"}),x(h,{prop:"app_name",label:"商城名称"}),x(h,{prop:"user_name",label:"超管账号"}),x(h,{prop:"is_recycle",label:"状态"},{default:w((e=>[x(f,{modelValue:e.row.is_recycle,"onUpdate:modelValue":a=>e.row.is_recycle=a,onChange:a=>d.statusChange(a,e.row)},{default:w((()=>[v("启用")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),x(h,{prop:"weixin_service",label:"微信服务商支付"},{default:w((e=>[x(f,{modelValue:e.row.weixin_service,"onUpdate:modelValue":a=>e.row.weixin_service=a,onChange:a=>d.wxStatusChange(a,e.row)},{default:w((()=>[v("启用")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),x(h,{prop:"expire_time_text",label:"过期时间"}),x(h,{prop:"create_time",label:"添加时间"}),x(h,{label:"操作",width:"150"},{default:w((e=>[x(_,{href:d.targetLinkAddress(),target:"_blank",type:"primary",size:"small"},{default:w((()=>[v("进入商城")])),_:1},8,["href"]),x(_,{class:"ml10",onClick:a=>d.editClick(e.row),type:"primary",size:"small"},{default:w((()=>[v("编辑")])),_:2},1032,["onClick"]),x(_,{class:"ml10",onClick:a=>d.deleteClick(e.row),type:"primary",size:"small"},{default:w((()=>[v("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[L,i.loading]])])])]),i.open_add?(g(),b(j,{key:0,open_add:i.open_add,onCloseDialog:a[0]||(a[0]=e=>d.closeDialogFunc(e,"add"))},null,8,["open_add"])):D("",!0),i.open_edit?(g(),b(E,{key:1,open_edit:i.open_edit,curModel:i.curModel,onCloseDialog:a[1]||(a[1]=e=>d.closeDialogFunc(e,"edit"))},null,8,["open_edit","curModel"])):D("",!0),V("div",B,[x(U,{small:"",onSizeChange:d.handleSizeChange,onCurrentChange:d.handleCurrentChange,background:"","current-page":i.curPage,"page-size":i.pageSize,layout:"total, prev, pager, next, jumper",total:i.totalDataNumber},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])),[[L,i.loading]])}]]);export{T as default};
