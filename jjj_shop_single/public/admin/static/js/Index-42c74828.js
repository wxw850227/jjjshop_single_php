import{f as e,c as a,d as l,m as t,n as o,o as s,b as i,e as d,i as r,E as n,k as m,v as c,p as u,j as p,q as h}from"./element-plus-1acdbba0.js";import{r as f}from"./request-55d87c89.js";import{_ as b,d as _,f as g}from"./index-660c53aa.js";import{o as V,S as w,R as D,a as y,O as k,V as C,X as L,c as v,_ as j,ad as U,W}from"./@vue-5f6096d8.js";import"./lodash-es-493ac664.js";import"./async-validator-cf877c1f.js";import"./@vueuse-9798be2d.js";import"./dayjs-342c85a3.js";import"./call-bind-0966096f.js";import"./get-intrinsic-ccd8a43d.js";import"./has-symbols-456daba2.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-e5d54f4f.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./axios-85bcd05e.js";import"./qs-9a0be292.js";import"./side-channel-7d553c0c.js";import"./object-inspect-1e1e9601.js";import"./vue-router-0438cf31.js";import"./pinia-a7eba4b6.js";import"./vue-demi-71ba0ef2.js";let S={accessList:(e,a)=>f._post("/admin/access/index",e,a),addpAccess:(e,a)=>f._post("/admin/access/add",e,a),editAccess:(e,a)=>f._post("/admin/access/edit",e,a),delAccess:(e,a)=>f._post("/admin/access/delete",e,a),status:(e,a)=>f._post("/admin/access/status",e,a)};const x={data:()=>({loading:!1,formData:{name:"",path:"",views:"",alias:"",icon:"",is_menu:1,is_route:1,is_show:0,sort:1,parent_id:0},formRules:{name:[{required:!0,message:"请输入菜单名称",trigger:"blur"}],path:[{required:!0,message:"请输入路径",trigger:"blur"}],views:[{required:!0,message:"请输入组件名称",trigger:"blur"}],alias:[{required:!0,message:"请输入别名",trigger:"blur"}]},parentsVal:[],accessList:[],srot:"1",formLabelWidth:"120px",dialogVisible:!1,propsParam:{label:"name",value:"access_id",checkStrictly:!0}}),props:{open_edit:Boolean,add_type:String,rawData:Array,selectModel:Object},created(){this.dialogVisible=this.open_edit,this.accessList=_(this.rawData),this.accessList.unshift({name:"顶级菜单",access_id:0}),this.formData=_(this.selectModel),this.findParentsID(this.accessList)},methods:{handleChange(e){},findParentsID(e){let a=!1;for(let l=0;l<e.length;l++){let t=e[l];if(t.access_id==this.formData.parent_id){this.parentsVal.unshift(t.access_id),a=!0;break}{let e=t.children;if(void 0!==e&&e.length>0&&this.findParentsID(e)){this.parentsVal.unshift(t.access_id),a=!0;break}}}return a},onSubmit(){let a=this,l=a.formData;a.parentsVal.length>0&&(l.parent_id=a.parentsVal[a.parentsVal.length-1]),a.$refs.form.validate((t=>{t&&(a.loading=!0,S.editAccess(l,!0).then((t=>{1==t.code&&(e({message:t.msg,type:"success"}),a.$emit("closeDialog",{type:"success",openDialog:!1,data:l}),a.loading=!1)})).catch((e=>{a.loading=!1})))}))},dialogFormVisible(e){this.$emit("closeDialog",{type:"error",openDialog:!1})}}},F=y("p",null,"提示：对应前端给的文件路径，例如：index/index",-1),M=y("p",null,"提示：请选择系统提供的图标",-1),P={class:"dialog-footer"};const A=b(x,[["render",function(e,n,m,c,u,p){const h=a,f=l,b=t,_=o,g=s,v=i,j=d,U=r;return V(),w(U,{title:"修改菜单&权限",modelValue:u.dialogVisible,"onUpdate:modelValue":n[11]||(n[11]=e=>u.dialogVisible=e),onClose:p.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:D((()=>[y("div",P,[k(j,{onClick:p.dialogFormVisible},{default:D((()=>[C("取 消")])),_:1},8,["onClick"]),k(j,{type:"primary",onClick:n[10]||(n[10]=e=>p.onSubmit()),disabled:u.loading},{default:D((()=>[C("确 定")])),_:1},8,["disabled"])])])),default:D((()=>[k(v,{model:u.formData,rules:u.formRules,ref:"form"},{default:D((()=>[k(f,{label:"菜单名称",prop:"name","label-width":u.formLabelWidth},{default:D((()=>[k(h,{modelValue:u.formData.name,"onUpdate:modelValue":n[0]||(n[0]=e=>u.formData.name=e),autocomplete:"off",placeholder:"请输入菜单名称"},null,8,["modelValue"])])),_:1},8,["label-width"]),k(f,{label:"类型",prop:"name","label-width":u.formLabelWidth},{default:D((()=>[k(_,{modelValue:u.formData.is_route,"onUpdate:modelValue":n[1]||(n[1]=e=>u.formData.is_route=e)},{default:D((()=>[k(b,{label:1},{default:D((()=>[C("页面")])),_:1}),k(b,{label:0},{default:D((()=>[C("按钮")])),_:1}),k(b,{label:2},{default:D((()=>[C("独立单页面")])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["label-width"]),k(f,{label:"上级菜单",prop:"parent_id","label-width":u.formLabelWidth},{default:D((()=>[k(g,{modelValue:u.parentsVal,"onUpdate:modelValue":n[2]||(n[2]=e=>u.parentsVal=e),options:u.accessList,props:u.propsParam,onChange:p.handleChange},null,8,["modelValue","options","props","onChange"])])),_:1},8,["label-width"]),k(f,{label:"路径",prop:"path","label-width":u.formLabelWidth},{default:D((()=>[k(h,{modelValue:u.formData.path,"onUpdate:modelValue":n[3]||(n[3]=e=>u.formData.path=e),autocomplete:"off",placeholder:"请输入组件文件路径",disabled:"/plus"==u.formData.path},null,8,["modelValue","disabled"]),F])),_:1},8,["label-width"]),k(f,{label:"图标","label-width":u.formLabelWidth},{default:D((()=>[k(h,{modelValue:u.formData.icon,"onUpdate:modelValue":n[4]||(n[4]=e=>u.formData.icon=e),autocomplete:"off",placeholder:"请输入icon"},null,8,["modelValue"]),M])),_:1},8,["label-width"]),1==u.formData.is_route?(V(),w(f,{key:0,label:"是否是菜单","label-width":u.formLabelWidth},{default:D((()=>[k(_,{modelValue:u.formData.is_menu,"onUpdate:modelValue":n[5]||(n[5]=e=>u.formData.is_menu=e)},{default:D((()=>[k(b,{label:1},{default:D((()=>[C("是")])),_:1}),k(b,{label:0},{default:D((()=>[C("否")])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["label-width"])):L("",!0),k(f,{label:"是否显示","label-width":u.formLabelWidth},{default:D((()=>[k(_,{modelValue:u.formData.is_show,"onUpdate:modelValue":n[6]||(n[6]=e=>u.formData.is_show=e)},{default:D((()=>[k(b,{label:1},{default:D((()=>[C("是")])),_:1}),k(b,{label:0},{default:D((()=>[C("否")])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["label-width"]),1==u.formData.is_route?(V(),w(f,{key:1,label:"重定向","label-width":u.formLabelWidth},{default:D((()=>[k(h,{modelValue:u.formData.redirect_name,"onUpdate:modelValue":n[7]||(n[7]=e=>u.formData.redirect_name=e),autocomplete:"off",placeholder:"请输入重定向地址"},null,8,["modelValue"])])),_:1},8,["label-width"])):L("",!0),k(f,{label:"备注",prop:"sort","label-width":u.formLabelWidth},{default:D((()=>[k(h,{modelValue:u.formData.remark,"onUpdate:modelValue":n[8]||(n[8]=e=>u.formData.remark=e),placeholder:"请输入备注",type:"textarea"},null,8,["modelValue"])])),_:1},8,["label-width"]),k(f,{label:"排序",prop:"sort","label-width":u.formLabelWidth},{default:D((()=>[k(h,{modelValue:u.formData.sort,"onUpdate:modelValue":n[9]||(n[9]=e=>u.formData.sort=e),placeholder:"请输入排序",type:"number"},null,8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"])}]]),q={data:()=>({loading:!1,formData:{name:"",path:"",views:"",alias:"",icon:"",is_menu:0,is_route:1,is_show:1,sort:1,parent_id:0},formRules:{name:[{required:!0,message:"请输入菜单名称",trigger:"blur"}],path:[{required:!0,message:"请输入路径",trigger:"blur"}],views:[{required:!0,message:"请输入组件名称",trigger:"blur"}],alias:[{required:!0,message:"请输入别名",trigger:"blur"}]},parentsVal:[],accessList:[],srot:"1",formLabelWidth:"120px",dialogVisible:!1,propsParam:{label:"name",value:"access_id",checkStrictly:!0}}),props:{open_add:Boolean,add_type:String,rawData:Array,selectModel:Object},created(){this.dialogVisible=this.open_add,this.accessList=_(this.rawData),this.accessList.unshift({name:"顶级菜单",access_id:0}),"copy"==this.add_type?(this.formData=g(this.formData,this.selectModel),this.findParentsID(this.accessList)):"child"==this.add_type&&(this.formData.parent_id=this.selectModel.access_id,this.findParentsID(this.accessList))},methods:{handleChange(e){},findParentsID(e){let a=!1;for(let l=0;l<e.length;l++){let t=e[l];if(t.access_id==this.formData.parent_id){this.parentsVal.unshift(t.access_id),a=!0;break}{let e=t.children;if(void 0!==e&&e.length>0&&this.findParentsID(e)){this.parentsVal.unshift(t.access_id),a=!0;break}}}return a},onSubmit(){let a=this,l=this.formData;a.parentsVal.length>0&&(l.parent_id=a.parentsVal[a.parentsVal.length-1]),a.$refs.form.validate((t=>{t&&(a.loading=!0,S.addpAccess(l,!0).then((l=>{1==l.code&&(e({message:l.msg,type:"success"}),a.dialogFormVisible(!0),a.loading=!1)})).catch((e=>{a.loading=!1})))}))},dialogFormVisible(e){e?this.$emit("closeDialog",{type:"success",openDialog:!1}):this.$emit("closeDialog",{type:"error",openDialog:!1})}}},T=y("p",null,"提示：对应前端给的文件路径，例如：/index/index",-1),I=y("p",null,"提示：请选择系统提供的图标",-1),$={class:"dialog-footer"};const R={class:"product"},z={class:"common-level-rail d-b-c"},E={class:"product-content"},B={class:"table-wrap"},O={key:0,class:"fb red f18"},X={key:1},G={key:0},H={key:1},J={key:2};const K=b({components:{Edit:A,Add:b(q,[["render",function(e,n,m,c,u,p){const h=a,f=l,b=t,_=o,g=s,v=i,j=d,U=r;return V(),w(U,{title:"添加菜单&权限",modelValue:u.dialogVisible,"onUpdate:modelValue":n[11]||(n[11]=e=>u.dialogVisible=e),onClose:p.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:D((()=>[y("div",$,[k(j,{onClick:p.dialogFormVisible},{default:D((()=>[C("取 消")])),_:1},8,["onClick"]),k(j,{type:"primary",onClick:n[10]||(n[10]=e=>p.onSubmit()),disabled:u.loading},{default:D((()=>[C("确 定")])),_:1},8,["disabled"])])])),default:D((()=>[k(v,{model:u.formData,rules:u.formRules,ref:"form"},{default:D((()=>[k(f,{label:"菜单名称",prop:"name","label-width":u.formLabelWidth},{default:D((()=>[k(h,{modelValue:u.formData.name,"onUpdate:modelValue":n[0]||(n[0]=e=>u.formData.name=e),autocomplete:"off",placeholder:"请输入菜单名称"},null,8,["modelValue"])])),_:1},8,["label-width"]),k(f,{label:"类型",prop:"name","label-width":u.formLabelWidth},{default:D((()=>[k(_,{modelValue:u.formData.is_route,"onUpdate:modelValue":n[1]||(n[1]=e=>u.formData.is_route=e)},{default:D((()=>[k(b,{label:1},{default:D((()=>[C("页面")])),_:1}),k(b,{label:0},{default:D((()=>[C("按钮")])),_:1}),k(b,{label:2},{default:D((()=>[C("独立单页面")])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["label-width"]),k(f,{label:"上级菜单",prop:"parent_id","label-width":u.formLabelWidth},{default:D((()=>[k(g,{modelValue:u.parentsVal,"onUpdate:modelValue":n[2]||(n[2]=e=>u.parentsVal=e),options:u.accessList,props:u.propsParam,onChange:p.handleChange},null,8,["modelValue","options","props","onChange"])])),_:1},8,["label-width"]),k(f,{label:"路径",prop:"path","label-width":u.formLabelWidth},{default:D((()=>[k(h,{modelValue:u.formData.path,"onUpdate:modelValue":n[3]||(n[3]=e=>u.formData.path=e),autocomplete:"off",placeholder:"请输入组件文件路径"},null,8,["modelValue"]),T])),_:1},8,["label-width"]),k(f,{label:"图标","label-width":u.formLabelWidth},{default:D((()=>[k(h,{modelValue:u.formData.icon,"onUpdate:modelValue":n[4]||(n[4]=e=>u.formData.icon=e),autocomplete:"off",placeholder:"请输入icon"},null,8,["modelValue"]),I])),_:1},8,["label-width"]),1==u.formData.is_route?(V(),w(f,{key:0,label:"是否是菜单","label-width":u.formLabelWidth},{default:D((()=>[k(_,{modelValue:u.formData.is_menu,"onUpdate:modelValue":n[5]||(n[5]=e=>u.formData.is_menu=e)},{default:D((()=>[k(b,{label:1},{default:D((()=>[C("是")])),_:1}),k(b,{label:0},{default:D((()=>[C("否")])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["label-width"])):L("",!0),k(f,{label:"是否显示","label-width":u.formLabelWidth},{default:D((()=>[k(_,{modelValue:u.formData.is_show,"onUpdate:modelValue":n[6]||(n[6]=e=>u.formData.is_show=e)},{default:D((()=>[k(b,{label:1},{default:D((()=>[C("是")])),_:1}),k(b,{label:0},{default:D((()=>[C("否")])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["label-width"]),1==u.formData.is_route?(V(),w(f,{key:1,label:"重定向","label-width":u.formLabelWidth},{default:D((()=>[k(h,{modelValue:u.formData.redirect_name,"onUpdate:modelValue":n[7]||(n[7]=e=>u.formData.redirect_name=e),autocomplete:"off",placeholder:"请输入重定向地址"},null,8,["modelValue"])])),_:1},8,["label-width"])):L("",!0),k(f,{label:"备注",prop:"sort","label-width":u.formLabelWidth},{default:D((()=>[k(h,{modelValue:u.formData.remark,"onUpdate:modelValue":n[8]||(n[8]=e=>u.formData.remark=e),placeholder:"请输入备注",type:"textarea"},null,8,["modelValue"])])),_:1},8,["label-width"]),k(f,{label:"排序",prop:"sort","label-width":u.formLabelWidth},{default:D((()=>[k(h,{modelValue:u.formData.sort,"onUpdate:modelValue":n[9]||(n[9]=e=>u.formData.sort=e),placeholder:"请输入排序",type:"number"},null,8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"])}]])},data:()=>({loading:!0,formSearch:{is_menu:!1,pack_up:!1},rawData:[],tableData:[],open_add:!1,add_type:"",selectModel:{},open_edit:!1,userModel:{}}),created(){this.getTableList()},methods:{changeIsMenuFunc(e){let a=_(this.rawData);e?(this.showScreen(a,1),this.tableData=a):this.tableData=a},isShowFunc(a){let l=this;S.status({access_id:a.access_id,status:a.is_show},!0).then((a=>{1==a.code&&(e({message:a.msg,type:"success"}),l.getTableList())})).catch((e=>{l.loading=!1}))},changePackUpFunc(e){this.forArr(this.tableData,!e)},forArr(e,a){e.forEach((e=>{this.$refs.theTable.toggleRowExpansion(e,a),e.children&&this.forArr(e.children,a)}))},changeShowFunc(e){let a=_(this.rawData);if("all"==e)this.tableData=a;else{let l;"show"==e&&(l=1),"hide"==e&&(l=0),this.showScreen(a,l),this.tableData=a}},showScreen(e,a){for(let l=0;l<e.length;l++){let t=e[l];void 0!==t.is_menu&&t.is_menu!=a?(e.splice(l,1),l--):t.children.length>0&&this.showScreen(t.children,a)}},getTableList(){let e=this;S.accessList({},!0).then((a=>{e.loading=!1,e.rawData=a.data,e.tableData=a.data})).catch((a=>{e.loading=!1}))},addClick(e,a){e&&void 0!==e?(this.add_type=a,this.selectModel=_(e)):this.parents_id=0,this.open_add=!0},editClick(e){this.selectModel=e,this.open_edit=!0},closeDialogFunc(e,a){"add"==a&&(this.open_add=e.openDialog,"success"==e.type&&this.getTableList()),"edit"==a&&(this.open_edit=e.openDialog,"success"==e.type&&this.getTableList())},deleteClick(a){let l=this;n.confirm("删除后不可恢复，确认删除该记录吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{l.loading=!0,S.delAccess({access_id:a.access_id},!0).then((a=>{1==a.code&&(l.loading=!1,e({message:a.msg,type:"success"}),l.getTableList())})).catch((e=>{l.loading=!1}))})).catch((()=>{}))}}},[["render",function(e,a,t,o,s,r){const n=d,f=u,b=l,_=i,g=p,S=h,x=m,F=U("Add"),M=U("Edit"),P=c;return V(),v("div",R,[y("div",z,[k(n,{type:"primary",onClick:r.addClick,icon:"Plus"},{default:D((()=>[C("添加菜单&权限")])),_:1},8,["onClick"]),k(_,{inline:!0,model:s.formSearch,size:"small"},{default:D((()=>[k(b,null,{default:D((()=>[k(f,{modelValue:s.formSearch.is_menu,"onUpdate:modelValue":a[0]||(a[0]=e=>s.formSearch.is_menu=e),onChange:r.changeIsMenuFunc},{default:D((()=>[C("只显示菜单")])),_:1},8,["modelValue","onChange"]),k(f,{modelValue:s.formSearch.pack_up,"onUpdate:modelValue":a[1]||(a[1]=e=>s.formSearch.pack_up=e),onChange:r.changePackUpFunc},{default:D((()=>[C("收起")])),_:1},8,["modelValue","onChange"])])),_:1})])),_:1},8,["model"])]),y("div",E,[y("div",B,[y("div",null,[j((V(),w(x,{size:"small",data:s.tableData,style:{width:"100%","margin-bottom":"20px"},"row-key":"access_id",border:"","default-expand-all":"",ref:"theTable","tree-props":{children:"children"}},{default:D((()=>[k(g,{prop:"name",label:"菜单名称"},{default:D((e=>["/plus"==e.row.path?(V(),v("span",O,W(e.row.name),1)):(V(),v("span",X,W(e.row.name),1))])),_:1}),k(g,{prop:"path",label:"路径"}),k(g,{prop:"is_route",label:"类别",width:"90"},{default:D((e=>[1==e.row.is_route?(V(),v("span",G,"页面")):L("",!0),0==e.row.is_route?(V(),v("span",H,"按钮")):L("",!0),2==e.row.is_route?(V(),v("span",J,"独立单页面")):L("",!0)])),_:1}),k(g,{prop:"is_show",label:"是否显示",width:"80"},{default:D((e=>[k(S,{modelValue:e.row.is_show,"onUpdate:modelValue":a=>e.row.is_show=a,"active-value":1,"inactive-value":0,onChange:a=>r.isShowFunc(e.row),"active-color":"#13ce66","inactive-color":"#cccccc"},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),k(g,{prop:"sort",label:"排序",width:"60"}),k(g,{prop:"create_time",label:"添加时间",width:"140"}),k(g,{prop:"name",label:"操作",width:"250"},{default:D((e=>["/plus"!=e.row.path?(V(),w(n,{key:0,onClick:a=>r.addClick(e.row,"copy"),type:"text"},{default:D((()=>[C("一键复制")])),_:2},1032,["onClick"])):L("",!0),k(n,{onClick:a=>r.addClick(e.row,"child"),type:"text",size:"small"},{default:D((()=>[C("添加子菜单")])),_:2},1032,["onClick"]),k(n,{onClick:a=>r.editClick(e.row),type:"text",size:"small"},{default:D((()=>[C("编辑")])),_:2},1032,["onClick"]),"/plus"!=e.row.path?(V(),w(n,{key:1,onClick:a=>r.deleteClick(e.row),type:"text"},{default:D((()=>[C("删除")])),_:2},1032,["onClick"])):L("",!0)])),_:1})])),_:1},8,["data"])),[[P,s.loading]])])])]),s.open_add?(V(),w(F,{key:0,open_add:s.open_add,add_type:s.add_type,rawData:s.rawData,selectModel:s.selectModel,onCloseDialog:a[2]||(a[2]=e=>r.closeDialogFunc(e,"add"))},null,8,["open_add","add_type","rawData","selectModel"])):L("",!0),s.open_edit?(V(),w(M,{key:1,open_edit:s.open_edit,rawData:s.rawData,selectModel:s.selectModel,onCloseDialog:a[3]||(a[3]=e=>r.closeDialogFunc(e,"edit"))},null,8,["open_edit","rawData","selectModel"])):L("",!0)])}]]);export{K as default};
