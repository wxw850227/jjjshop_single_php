import{_ as e}from"./AddCategory-f060626c.js";import{a as t,E as a,s as i,f as l,A as o,t as s,B as c,n,o as r}from"./element-plus-68e4b1c7.js";import{F as g}from"./file-c3df6c02.js";import{ae as d,o as p,c as u,P as h,S as f,W as y,a as m,Q as _,a9 as C,X as v,M as k,a1 as F,Y as b,V as w,T as z}from"./@vue-76da2f05.js";/* empty css                                                               */import{_ as S}from"./index-d5abae2c.js";const x={class:"upload-wrap"},L={class:"upload-wrap-inline mb16 clearfix"},T={class:"leval-item"},D={class:"move-type"},j=["onClick"],I={class:"leval-item upload-btn"},B={class:"fileContainer"},P={class:"file-type"},U=["onClick"],V=["onClick"],E=["onClick"],N={class:"file-content"},A={class:"fileContainerUI clearfix"},W=["onClick"],q={key:0,class:"selectedIcon"},O={class:"iconBox"},$=["scr"],M=["src"],Q={class:"desc"},X=["onClick"],Y={class:"pagination-wrap"};const G=S({components:{AddCategory:e},data:()=>({dialogWidth:"910px",activeType:null,typeList:[],imageUrl:null,dialogVisible:!0,fileList:[],addLoading:!1,this_config:{total:1,file_type:"image"},record:0,loading:!0,tableData:[],pageSize:36,totalDataNumber:0,curPage:1,isShowCategory:!1,category:null,fileIds:[],accept:""}),props:["config"],created(){if("[object object]"===Object.prototype.toString.call(this.config).toLowerCase()){for(let e in this.config)this.this_config[e]=this.config[e];"image"==this.this_config.file_type?this.accept="image/jpeg,image/png,image/jpg":this.accept="video/mp4"}this.getFileCategory(),this.getData()},methods:{getFileCategory(){let e=this;g.fileCategory({type:e.this_config.file_type},!0).then((t=>{e.typeList=[{group_id:null,group_name:"全部"}].concat(t.data.group_list)})).catch((t=>{e.loading=!1}))},addCategory(){this.isShowCategory=!0},editCategoryFunc(e){this.isShowCategory=!0,this.category=e},closeCategoryFunc(e){null!=e&&this.getFileCategory(),this.isShowCategory=!1},deleteCategoryFunc(e){t.confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.deleteCategory(e)})).catch((()=>{a({type:"info",message:"已取消删除"})}))},deleteCategory(e){let t=this;g.deleteCategory({group_id:e}).then((e=>{a({message:"删除成功",type:"success"}),t.getFileCategory()})).catch((e=>{a.error("删除失败")}))},selectTypeFunc(e){this.activeType=e,this.curPage=1,this.getData()},handleCurrentChange(e){this.curPage=e,this.getData()},handleSizeChange(e){this.curPage=1,this.pageSize=e,this.getData()},getData:function(){let e=this,t={page:e.curPage,pageSize:e.pageSize,group_id:e.activeType,type:e.this_config.file_type};g.fileList(t,!0).then((t=>{e.loading=!1,e.fileList=t.data.file_list,e.totalDataNumber=e.fileList.total})).catch((t=>{e.loading=!1}))},moveTypeFunc(e){let i=this,l=[];i.fileList.data.forEach((e=>{e.selected&&l.push(e.file_id)})),0!=l.length?t.confirm("确定移动选中的文件吗, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{g.moveFile({group_id:e,fileIds:l},!0).then((e=>{a({message:"移动成功",type:"success"}),i.getFileCategory(),i.getData()})).catch((e=>{}))})).catch((()=>{})):a({message:"请选择文件",type:"warning"})},fileChange(e){},onBeforeUploadImage:e=>!0,UploadImage(e){let t=this;const l=i.service({lock:!0,text:"图片上传中,请等待",background:"rgba(0, 0, 0, 0.7)"}),o=new FormData;o.append("iFile",e.file),o.append("group_id",t.activeType),o.append("file_type",t.this_config.file_type),g.uploadFile(o).then((a=>{l.close(),t.getData(),e.onSuccess()})).catch((t=>{l.close(),a({message:"本次上传图片失败",type:"warning"}),e.onError()}))},selectFileFunc(e,t){if(e.selected)e.selected=!1,this.record--;else{if(e.selected=!0,this.record++,this.record>=this.this_config.total)return void a({message:"本次最多只能上传 "+this.this_config.total+" 个文件",type:"warning"});e.selected=!0,this.record++}},deleteFileFunc(e){let l=this;t.confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const t=i.service({lock:!0,text:"图片上传中,请等待",background:"rgba(0, 0, 0, 0.7)"});let o=[];if(e)o.push(e.file_id);else for(let e=0;e<l.fileList.data.length;e++){let t=l.fileList.data[e];t.selected&&o.push(t.file_id)}g.deleteFiles({fileIds:o},!0).then((e=>{t.close(),a({message:"删除成功",type:"success"}),l.getData()})).catch((e=>{t.close()}))})).catch((()=>{loading.close(),a({message:"删除失败",type:"warning"})}))},confirmFunc(){let e=[],t=0;for(let a=0;a<this.fileList.data.length;a++){let i=this.fileList.data[a];if(i.selected){let a={file_id:i.file_id,file_path:i.file_path};e.push(a),t++}if(t>this.this_config.total)break}this.$emit("returnImgs",e)},cancelFunc(){this.$emit("returnImgs",null)}}},[["render",function(t,a,i,g,S,G){const H=l,J=o,K=s,R=d("Edit"),Z=c,ee=d("Delete"),te=d("Select"),ae=n,ie=r,le=e;return p(),u("div",x,[h(ie,{title:"文件管理",modelValue:S.dialogVisible,"onUpdate:modelValue":a[3]||(a[3]=e=>S.dialogVisible=e),"close-on-click-modal":!1,"custom-class":"upload-dialog","close-on-press-escape":!1,onClose:G.cancelFunc,width:S.dialogWidth,"append-to-body":!0},{footer:f((()=>[h(H,{size:"small",onClick:G.cancelFunc},{default:f((()=>[y("取 消")])),_:1},8,["onClick"]),h(H,{size:"small",type:"primary",onClick:G.confirmFunc},{default:f((()=>[y("确 定")])),_:1},8,["onClick"])])),default:f((()=>[m("div",L,[m("div",T,[h(H,{size:"small",icon:"Plus",onClick:G.addCategory},{default:f((()=>[y("添加分类")])),_:1},8,["onClick"]),h(J,{placement:"bottom",width:"200",trigger:"click",value:!0},{reference:f((()=>[h(H,{size:"small",icon:"CaretBottom"},{default:f((()=>[y("移动至")])),_:1})])),default:f((()=>[m("ul",D,[(p(!0),u(_,null,C(S.typeList,((e,t)=>(p(),u("li",{key:t,onClick:t=>G.moveTypeFunc(e.group_id)},v(e.group_name),9,j)))),128))])])),_:1}),h(H,{size:"small",type:"danger",icon:"Delete",onClick:a[0]||(a[0]=e=>G.deleteFileFunc(!1))},{default:f((()=>[y("批量删除")])),_:1})]),m("div",I,[h(K,{class:"avatar-uploader",multiple:"",ref:"upload",action:"string",accept:S.accept,"before-upload":G.onBeforeUploadImage,"http-request":G.UploadImage,"show-file-list":!1,"on-change":G.fileChange},{default:f((()=>[h(H,{size:"small",icon:"Upload",type:"primary"},{default:f((()=>[y("点击上传")])),_:1})])),_:1},8,["accept","before-upload","http-request","on-change"])])]),m("div",B,[m("div",P,[m("ul",null,[(p(!0),u(_,null,C(S.typeList,((e,t)=>(p(),u("li",{class:k(S.activeType==e.group_id?"item active":"item"),key:t,onClick:t=>G.selectTypeFunc(e.group_id)},[y(v(e.group_name)+" ",1),null!=e.group_id?(p(),u("div",{key:0,class:"operation",onClick:a[1]||(a[1]=F((()=>{}),["stop"]))},[m("p",{onClick:t=>G.editCategoryFunc(e)},[h(Z,null,{default:f((()=>[h(R)])),_:1})],8,V),m("p",{onClick:t=>G.deleteCategoryFunc(e.group_id)},[h(Z,null,{default:f((()=>[h(ee)])),_:1})],8,E)])):b("",!0)],10,U)))),128))])]),m("div",N,[m("ul",A,[(p(!0),u(_,null,C(S.fileList.data,((e,t)=>(p(),u("li",{class:"file",key:t,onClick:a=>G.selectFileFunc(e,t)},[1==e.selected?(p(),u("div",q,[m("div",O,[h(Z,null,{default:f((()=>[h(te)])),_:1})])])):b("",!0),"image"==S.this_config.file_type?(p(),u("img",{key:1,scr:e.file_path,style:w("background-image:url("+e.file_path+")"),alt:""},null,12,$)):b("",!0),"video"==S.this_config.file_type?(p(),u("video",{key:2,height:"100",width:"100",src:e.file_path,autoplay:!1}," 您的浏览器不支持 video 标签 ",8,M)):b("",!0),m("p",Q,v(e.real_name),1),m("div",{class:"bottom-shade",onClick:a[2]||(a[2]=F((()=>{}),["stop"]))},[m("a",{href:"javascript:void(0)",onClick:t=>G.deleteFileFunc(e)},[h(Z,null,{default:f((()=>[h(ee)])),_:1})],8,X)])],8,W)))),128))])])]),m("div",Y,[h(ae,{onSizeChange:G.handleSizeChange,onCurrentChange:G.handleCurrentChange,"current-page":S.curPage,"page-sizes":[12,24,36,42,48],"page-size":S.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:S.totalDataNumber},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])),_:1},8,["modelValue","onClose","width"]),S.isShowCategory?(p(),z(le,{key:0,category:S.category,file_type:S.this_config.file_type,onCloseCategory:G.closeCategoryFunc},null,8,["category","file_type","onCloseCategory"])):b("",!0)])}],["__scopeId","data-v-e92f80dd"]]);export{G as _};
