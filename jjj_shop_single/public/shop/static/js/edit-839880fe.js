import{E as e,u as t,w as a,f as i,c as o,v as s}from"./element-plus-68e4b1c7.js";import{P as r}from"./product-03ba16fa.js";import d from"./Basic-1570c5fa.js";import l from"./Spec-2f43277e.js";import n from"./Content-8eeddd88.js";import m from"./Buyset-dd3cad4b.js";import{_ as c,f as p}from"./index-c1104e7d.js";import{ae as u,$ as _,o as f,c as g,P as j,S as y,T as v,a0 as b,a as h,W as k,Y as S}from"./@vue-76da2f05.js";import"./@vueuse-90d34f35.js";import"./lodash-es-3f297d7c.js";import"./async-validator-cf877c1f.js";import"./dayjs-13b7e569.js";import"./call-bind-6a1b7bd0.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-9f5f6982.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./Upload-3b016181.js";import"./AddCategory-35fb7824.js";import"./file-9f429f58.js";/* empty css                                                               */import"./vuedraggable-13be42ee.js";import"./vue-407f4729.js";import"./sortablejs-9c07ead7.js";import"./vue-router-b6ab34d8.js";import"./pinia-58dabe83.js";import"./vue-demi-71ba0ef2.js";import"./axios-85bcd05e.js";import"./qs-74887072.js";import"./side-channel-9348fcaa.js";import"./object-inspect-c71aff05.js";import"./vue-clipboard2-8d1bb64a.js";import"./clipboard-fb55ee1a.js";import"./vue-ueditor-wrap-c9660067.js";import"./Single-23c48de4.js";import"./Many-71fce911.js";import"./UE-de93c921.js";const q={class:"product-add"},w={class:"common-button-wrapper"};const N=c({components:{Basic:d,Spec:l,Content:n,Buyset:m},data:()=>({activeName:"basic",product_id:0,scene:"edit",loading:!0,save_loading:!1,form:{model:{},catgory:[],delivery:[],gradeList:[],specData:null,isSpecLocked:!1,basicSetting:{},tableList:[]},model:{product_name:"",video_id:0,poster_id:0,category_id:null,image:[],is_picture:0,contentImage:[],selling_point:"",spec_type:10,deduct_stock_type:20,is_alone_grade:0,sku:{product_price:0,line_price:0,stock_num:0,product_weight:0,product_no:"",product_sku_id:""},spec_many:{spec_attr:[],spec_list:[]},content:"",delivery_id:"",product_status:10,sales_initial:0,product_sort:100,is_points_gift:1,is_points_discount:1,max_points_discount:0,is_enable_grade:1,alone_grade_type:10,grade_ids:[],is_ind_agent:0,agent_money_type:10,first_money:0,second_money:0,third_money:0,is_virtual:0,limit_num:0,virtual_auto:0,virtual_content:"",table_id:"",is_preview:0,preview_time:""}}),provide:function(){return{form:this.form}},created(){this.product_id=this.$route.query.product_id,this.scene=this.$route.query.scene,this.getData()},methods:{getData:function(){let e=this;r.getEditData({product_id:e.product_id,scene:e.scene},!0).then((t=>{if(e.loading=!1,null!=t.data.model.alone_grade_equity&&void 0!==t.data.model.alone_grade_equity){let e=t.data.model.alone_grade_equity;t.data.gradeList.forEach((t=>{t.product_equity=e[t.grade_id]}))}Object.assign(e.form,t.data),t.data.specData?e.form.model.spec_many=t.data.specData:(e.form.model.spec_many={spec_attr:[],spec_list:[]},e.form.model.sku=t.data.model.sku[0]),e.form.model.product_status=t.data.model.product_status.value;for(let a=0;a<e.form.model.grade_ids.length;a++)e.form.model.grade_ids[a]=parseInt(e.form.model.grade_ids[a]);0==e.form.model.table_id&&(e.form.model.table_id="")})).catch((t=>{e.loading=!1}))},convertJson(e){let t={};return e.forEach((e=>{t[e.grade_id]=e.product_equity})),JSON.stringify(t)},onSubmit:function(){let t=this;t.$refs.form.validate((a=>{if(a){let a=p(t.model,t.form.model);a.scene=t.scene,a.image=t.ImgKeepId(a.image),a.product_id=t.product_id,a.alone_grade_equity=t.convertJson(t.form.gradeList),t.save_loading=!0,r.editProduct({product_id:t.product_id,scene:t.scene,params:JSON.stringify(a)},!0).then((a=>{t.save_loading=!1,e({message:"保存成功",type:"success"}),t.cancelFunc()})).catch((e=>{t.save_loading=!1}))}}))},ImgKeepId(e){let t=[];for(let a=0,i=e.length;a<i;a++){let i={image_id:e[a].image_id,file_id:e[a].file_id};t.push(i)}return t},Draft(){this.form.model.product_status=30,this.onSubmit()},cancelFunc(){this.$router.back(-1)}}},[["render",function(e,r,d,l,n,m){const c=t,p=a,N=u("Basic"),x=u("Spec"),C=u("Content"),D=u("Buyset"),I=i,z=o,B=s;return _((f(),g("div",q,[j(p,{modelValue:n.activeName,"onUpdate:modelValue":r[0]||(r[0]=e=>n.activeName=e),type:"card"},{default:y((()=>[j(c,{label:"基础设置",name:"basic"}),j(c,{label:"规格库存",name:"spec"}),j(c,{label:"商品详情",name:"content"}),j(c,{label:"高级设置",name:"buyset"})])),_:1},8,["modelValue"]),n.loading?S("",!0):(f(),v(z,{key:0,size:"small",ref:"form",model:n.form,"label-width":"180px"},{default:y((()=>[_(j(N,null,null,512),[[b,"basic"==n.activeName]]),_(j(x,null,null,512),[[b,"spec"==n.activeName]]),_(j(C,null,null,512),[[b,"content"==n.activeName]]),_(j(D,null,null,512),[[b,"buyset"==n.activeName]]),h("div",w,[j(I,{size:"small",type:"info",onClick:m.cancelFunc},{default:y((()=>[k("取消")])),_:1},8,["onClick"]),j(I,{size:"small",type:"primary",onClick:m.onSubmit,disabled:n.save_loading},{default:y((()=>[k("发布")])),_:1},8,["onClick","disabled"])])])),_:1},8,["model"]))])),[[B,n.loading]])}],["__scopeId","data-v-d2def874"]]);export{N as default};
