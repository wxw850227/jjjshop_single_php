import{E as e,a as o,B as l,C as a,d as s,f as t,l as p,e as d,m as r}from"./element-plus-68e4b1c7.js";import{P as m}from"./product-a5c451ce.js";import{ae as i,o as c,c as n,a as u,Q as _,a9 as f,X as h,P as g,S as y,W as b,Y as V,$ as w,a0 as k,bb as v,b9 as j,ap as G,T as x}from"./@vue-76da2f05.js";import{_ as D}from"./index-d5abae2c.js";import{_ as F}from"./Upload-b4b0cf8c.js";import"./@vueuse-90d34f35.js";import"./lodash-es-3f297d7c.js";import"./async-validator-cf877c1f.js";import"./dayjs-13b7e569.js";import"./call-bind-6a1b7bd0.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-9f5f6982.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-b6ab34d8.js";import"./pinia-58dabe83.js";import"./vue-demi-71ba0ef2.js";import"./axios-85bcd05e.js";import"./qs-74887072.js";import"./side-channel-9348fcaa.js";import"./object-inspect-c71aff05.js";import"./vue-clipboard2-8d1bb64a.js";import"./clipboard-fb55ee1a.js";import"./vue-ueditor-wrap-c9660067.js";import"./AddCategory-f060626c.js";import"./file-c3df6c02.js";/* empty css                                                               */const A={data:()=>({showAddGroupBtn:!0,showAddGroupForm:!1,addGroupFrom:{specName:"",specValue:""},groupLoading:!1}),inject:["form"],created(){this.form.model.spec_many&&this.form.model.spec_many.spec_list.length>0&&this.buildSkulist()},methods:{onToggleAddGroupForm:function(){this.showAddGroupBtn=!this.showAddGroupBtn,this.showAddGroupForm=!this.showAddGroupForm},onSubmitAddGroup:function(){let o=this;if(""===o.addGroupFrom.specName||""===o.addGroupFrom.specValue)return e("请填写规则名或规则值"),!1;o.groupLoading=!0;let l={spec_name:o.addGroupFrom.specName,spec_value:o.addGroupFrom.specValue};m.addSpec(l,!0).then((e=>{o.groupLoading=!1,o.form.model.spec_many.spec_attr.push({group_id:e.data.spec_id,group_name:o.addGroupFrom.specName,spec_items:[{item_id:e.data.spec_value_id,spec_value:o.addGroupFrom.specValue}],tempValue:"",loading:!1}),o.addGroupFrom.specName="",o.addGroupFrom.specValue="",o.onToggleAddGroupForm(),o.buildSkulist()})).catch((e=>{o.groupLoading=!1}))},onSubmitAddValue:function(o){let l=this;if(!o.hasOwnProperty("tempValue")||""===o.tempValue)return e("规格值不能为空"),!1;o.loading=!0;let a={spec_id:o.group_id,spec_value:o.tempValue};m.addSpecValue(a,!0).then((e=>{o.loading=!1,o.spec_items.push({item_id:e.data.spec_value_id,spec_value:o.tempValue}),o.tempValue="",l.buildSkulist()})).catch((e=>{o.loading=!1}))},buildSkulist:function(){let e=this,o=e.form.model.spec_many.spec_attr,l=[];for(let t=0;t<o.length;t++)l.push(o[t].spec_items);let a=e.calcDescartes(l),s=[];for(let t=0;t<a.length;t++){let e=[],o=[];Array.isArray(a[t])?e=a[t]:e.push(a[t]);for(let l=0;l<e.length;l++)o.push(e[l].item_id);s.push({product_sku_id:0,spec_sku_id:o.join("_"),rows:e,spec_form:{}})}if(e.form.model.spec_many.spec_list.length>0&&s.length>0)for(let t=0;t<s.length;t++){let o=e.form.model.spec_many.spec_list.filter((function(e){return e.spec_sku_id===s[t].spec_sku_id}));o.length>0&&(s[t].spec_form=o[0].spec_form,s[t].product_sku_id=o[0].product_sku_id)}e.form.model.spec_many.spec_list=s},calcDescartes:function(e){return e.length<2?e[0]||[]:[].reduce.call(e,(function(e,o){let l=[];return e.forEach((function(e){o.forEach((function(o){let a=[].concat(Array.isArray(e)?e:[e]);a.push(o),l.push(a)}))})),l}))},onDeleteGroup:function(e){var l=this;o.confirm("删除后不可恢复，确认删除该记录吗?","提示",{type:"warning"}).then((()=>{l.form.model.spec_many.spec_attr.splice(e,1),l.buildSkulist()}))},onDeleteValue:function(l,a){let s=this;s.form.isSpecLocked?e({message:"本商品正在搞活动，不能删除规格！",type:"warning"}):o.confirm("删除后不可恢复，确认删除该记录吗?","提示",{type:"warning"}).then((()=>{s.form.model.spec_many.spec_attr[l].spec_items.splice(a,1),s.buildSkulist()}))}}},S=e=>(v("data-v-6a4e53ea"),e=e(),j(),e),U={class:"spec-many-type"},z={class:"spec-wrap"},C={class:"spec-hd"},I={class:"input-box"},T=["onClick"],B={class:"spec-bd"},N={class:"item"},L={class:"item"},q={key:1},P={class:"add-spec mb16"},$={class:"from-box"},E={class:"item"},M=S((()=>u("span",{class:"key"},"规格名：",-1))),O={class:"item"},R=S((()=>u("span",{class:"key"},"规格值：",-1)));const J={class:"mt16"},Q=["onClick"];const W=D({components:{Type:D(A,[["render",function(e,o,p,d,r,m){const v=i("Delete"),j=l,G=a,x=s,D=t;return c(),n("div",U,[u("div",z,[m.form.model&&m.form.model.spec_many&&m.form.model.spec_many.spec_attr?(c(!0),n(_,{key:0},f(m.form.model.spec_many.spec_attr,((e,o)=>(c(),n("div",{class:"mb16 min-spc",key:e.group_name},[u("div",C,[u("div",I,h(e.group_name),1),u("a",{href:"javascript:void(0);",onClick:e=>m.onDeleteGroup(o)},[g(j,null,{default:y((()=>[g(v)])),_:1})],8,T)]),u("div",B,[(c(!0),n(_,null,f(e.spec_items,((e,l)=>(c(),n("div",{class:"item",key:e.spec_value},[g(G,{closable:"",onClose:e=>m.onDeleteValue(o,l)},{default:y((()=>[b(h(e.spec_value),1)])),_:2},1032,["onClose"])])))),128)),u("div",N,[g(x,{size:"small",modelValue:e.tempValue,"onUpdate:modelValue":o=>e.tempValue=o,style:{width:"160px"}},null,8,["modelValue","onUpdate:modelValue"])]),u("div",L,[g(D,{size:"small",onClick:o=>m.onSubmitAddValue(e),loading:e.loading},{default:y((()=>[b("添加")])),_:2},1032,["onClick","loading"])])])])))),128)):V("",!0),m.form.isSpecLocked?V("",!0):(c(),n("div",q,[w(g(D,{size:"small",class:"el-icon-circle-plus",onClick:m.onToggleAddGroupForm},{default:y((()=>[b("添加规格")])),_:1},8,["onClick"]),[[k,r.showAddGroupBtn]])])),w(u("div",P,[u("div",$,[u("div",E,[M,g(x,{size:"small",modelValue:r.addGroupFrom.specName,"onUpdate:modelValue":o[0]||(o[0]=e=>r.addGroupFrom.specName=e),placeholder:"请输入规格名称"},null,8,["modelValue"])]),u("div",O,[R,g(x,{size:"small",modelValue:r.addGroupFrom.specValue,"onUpdate:modelValue":o[1]||(o[1]=e=>r.addGroupFrom.specValue=e),placeholder:"请输入规格值"},null,8,["modelValue"])]),g(D,{type:"primary",size:"small",loading:r.groupLoading,onClick:m.onSubmitAddGroup,plain:""},{default:y((()=>[b("确定")])),_:1},8,["loading","onClick"]),g(D,{size:"small",onClick:m.onToggleAddGroupForm},{default:y((()=>[b("取消")])),_:1},8,["onClick"])])],512),[[k,!r.showAddGroupBtn]])])])}],["__scopeId","data-v-6a4e53ea"]]),Table:D({components:{Upload:F},data:()=>({batchData:{product_price:"",line_price:"",stock_num:"",product_weight:""},isupload:!1,spec_index:-1}),inject:["form"],created(){},methods:{objectSpanMethod({row:e,column:o,rowIndex:l,columnIndex:a}){var s=this.form.model.spec_many.spec_attr,t=1;if(a<s.length-1){let e=a+1,o=s.length-1;for(var p=e;p<=o;p++)t*=s[p].spec_items.length;return l%t==0?{rowspan:t,colspan:1}:{rowspan:0,colspan:0}}},onSubmitBatchData:function(){var e=this;e.form.model.spec_many.spec_list.forEach((function(o){for(var l in e.batchData)e.batchData.hasOwnProperty(l)&&e.batchData[l]&&(o.spec_form[l]=e.batchData[l])}))},chooseSpecImage:function(e){this.isupload=!0,this.spec_index=e},returnImgsFunc(e){this.isupload=!1,this.form.model.spec_many.spec_list[this.spec_index].spec_form.image_id=e[0].file_id,this.form.model.spec_many.spec_list[this.spec_index].spec_form.image_path=e[0].file_path}}},[["render",function(e,o,l,a,m,i){const k=s,v=t,j=p,D=d,A=r,S=F,U=G("img-url");return c(),n("div",J,[i.form.model.spec_many&&i.form.model.spec_many.spec_list.length>0?(c(),x(D,{key:0,label:"规格明细："},{default:y((()=>[u("div",null,[b(" 批量设置 "),g(k,{size:"small",modelValue:m.batchData.product_price,"onUpdate:modelValue":o[0]||(o[0]=e=>m.batchData.product_price=e),placeholder:"销售价",style:{width:"160px","padding-left":"4px"}},null,8,["modelValue"]),g(k,{size:"small",modelValue:m.batchData.line_price,"onUpdate:modelValue":o[1]||(o[1]=e=>m.batchData.line_price=e),placeholder:"划线价",style:{width:"160px","padding-left":"4px"}},null,8,["modelValue"]),g(k,{size:"small",modelValue:m.batchData.stock_num,"onUpdate:modelValue":o[2]||(o[2]=e=>m.batchData.stock_num=e),placeholder:"库存",style:{width:"160px","padding-left":"4px"}},null,8,["modelValue"]),g(k,{size:"small",modelValue:m.batchData.product_weight,"onUpdate:modelValue":o[3]||(o[3]=e=>m.batchData.product_weight=e),placeholder:"重量",style:{width:"160px","padding-left":"4px"}},null,8,["modelValue"]),g(v,{size:"small",onClick:i.onSubmitBatchData,style:{"margin-left":"4px"}},{default:y((()=>[b("应用")])),_:1},8,["onClick"])]),i.form.model&&i.form.model.spec_many&&i.form.model.spec_many.spec_attr?(c(),x(A,{key:0,size:"small",data:i.form.model.spec_many.spec_list,"span-method":i.objectSpanMethod,border:"",style:{width:"100%","margin-top":"20px"}},{default:y((()=>[(c(!0),n(_,null,f(i.form.model.spec_many.spec_attr,((e,o)=>(c(),x(j,{label:e.group_name,key:e.group_name},{default:y((e=>[b(h(e.row.rows[o].spec_value),1)])),_:2},1032,["label"])))),128)),g(j,{label:"规格图片"},{default:y((e=>[w(u("img",{alt:"",width:35,height:35,onClick:o=>i.chooseSpecImage(e.$index)},null,8,Q),[[U,e.row.spec_form.image_path]])])),_:1}),g(j,{label:"商品条码"},{default:y((e=>[g(D,{label:"",style:{"margin-bottom":"0"}},{default:y((()=>[g(k,{size:"small",prop:"product_no",modelValue:e.row.spec_form.product_no,"onUpdate:modelValue":o=>e.row.spec_form.product_no=o},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:1}),g(j,{label:"销售价"},{default:y((e=>[g(D,{label:"",rules:[{required:!0,message:" "}],prop:"model.spec_many.spec_list."+e.$index+".spec_form.product_price",style:{"margin-bottom":"0"}},{default:y((()=>[g(k,{size:"small",prop:"product_price",modelValue:e.row.spec_form.product_price,"onUpdate:modelValue":o=>e.row.spec_form.product_price=o},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:1}),g(j,{label:"划线价"},{default:y((e=>[g(D,{label:"",style:{"margin-bottom":"0"}},{default:y((()=>[g(k,{size:"small",prop:"line_price",modelValue:e.row.spec_form.line_price,"onUpdate:modelValue":o=>e.row.spec_form.line_price=o},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:1}),g(j,{label:"库存"},{default:y((e=>[g(D,{label:"",rules:[{required:!0,message:" "}],prop:"model.spec_many.spec_list."+e.$index+".spec_form.stock_num",style:{"margin-bottom":"0"}},{default:y((()=>[g(k,{size:"small",prop:"stock_num",modelValue:e.row.spec_form.stock_num,"onUpdate:modelValue":o=>e.row.spec_form.stock_num=o},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:1}),g(j,{label:"重量(kg)"},{default:y((e=>[g(D,{label:"",rules:[{required:!0,message:" "}],prop:"model.spec_many.spec_list."+e.$index+".spec_form.product_weight",style:{"margin-bottom":"0"}},{default:y((()=>[g(k,{size:"small",prop:"product_weight",modelValue:e.row.spec_form.product_weight,"onUpdate:modelValue":o=>e.row.spec_form.product_weight=o},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:1})])),_:1},8,["data","span-method"])):V("",!0)])),_:1})):V("",!0),m.isupload?(c(),x(S,{key:1,isupload:m.isupload,onReturnImgs:i.returnImgsFunc},{default:y((()=>[b("上传图片")])),_:1},8,["isupload","onReturnImgs"])):V("",!0)])}]])}},[["render",function(e,o,l,a,s,t){const p=i("Type"),d=i("Table");return c(),n("div",null,[g(p),g(d)])}]]);export{W as default};
