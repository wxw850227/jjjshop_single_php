import{E as e,u as l,w as a,d as o,e as t,i as d,F as i,x as r,f as s,l as u,m as p,C as m,c,v as n}from"./element-plus-68e4b1c7.js";import{_}from"./category-e8d04341.js";import{_ as f}from"./Product-e5bb92d9.js";import{C as y}from"./coupon-e6c73f62.js";import{_ as g,f as b}from"./index-c1104e7d.js";import{ap as h,$ as V,o as v,c as j,P as k,S as x,Q as C,W as U,Y as w,T as D,a as z,a9 as F,X as I,bb as $,b9 as q}from"./@vue-76da2f05.js";import"./@vueuse-90d34f35.js";import"./lodash-es-3f297d7c.js";import"./async-validator-cf877c1f.js";import"./dayjs-13b7e569.js";import"./call-bind-6a1b7bd0.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-9f5f6982.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./product-03ba16fa.js";import"./vue-router-b6ab34d8.js";import"./pinia-58dabe83.js";import"./vue-demi-71ba0ef2.js";import"./axios-85bcd05e.js";import"./qs-74887072.js";import"./side-channel-9348fcaa.js";import"./object-inspect-c71aff05.js";import"./vue-clipboard2-8d1bb64a.js";import"./clipboard-fb55ee1a.js";import"./vue-ueditor-wrap-c9660067.js";const N={components:{Product:f,Category:_},data:()=>({activeName:"1",form:{coupon_id:"",name:"",color:"",coupon_type:"",reduce_price:"",discount:"",min_price:"",expire_type:"",expire_day:"",active_time:"",total_num:"",show_center:1,free_limit:0,sort:1,apply_range:10},list:{},loading:!0,pickerOptions0:{disabledDate:e=>e.getTime()<Date.now()-864e5},is_category:!1,is_product:!1,exclude_ids:[],product_list:[],category_list:{second:[],first:[]},category_ids:[]}),created(){let e=this.$route.query.coupon_id;this.getData(e)},methods:{hasImages:e=>e||"",getData(e){let l=this;y.couponDetail({coupon_id:e},!0).then((e=>{let a={};if(a=e.data.detail,a.color=e.data.detail.color.value,a.coupon_type=e.data.detail.coupon_type.value,l.form=b(l.form,a),20==l.form.apply_range){l.exclude_ids=e.data.detail.product_ids;for(let e=0;e<l.exclude_ids.length;e++)l.exclude_ids[e]=parseInt(l.exclude_ids[e]);l.product_list=e.data.detail.product_list}30==l.form.apply_range&&(l.category_list=e.data.detail.category_list),l.loading=!1})).catch((e=>{l.loading=!1}))},onSubmit(){let l=this,a=l.form;a.product_ids=l.exclude_ids,a.category_list=l.category_list,l.$refs.form.validate((o=>{o?(l.loading=!0,y.editCoupon(a,!0).then((a=>{l.loading=!1,e({message:"恭喜你，修改成功",type:"success"}),l.$router.push("/plus/coupon/index")})).catch((e=>{l.loading=!1}))):l.loading=!1}))},closeCategoryFunc(e){let l=this;l.is_category=!1,e&&(l.category_list=e)},closeProductFunc(e){let l=this;l.is_product=e.openDialog,"success"==e.type&&e.params.forEach(((e,a)=>{let o={product_id:e.product_id,product_name:e.product_name,product_image:e.product_image};l.exclude_ids.push(o.product_id),l.product_list.push(o)}))},cancelFunc(){this.$router.push({path:"/plus/coupon/index"})},deleteClick(e){this.exclude_ids.splice(e,1),this.product_list.splice(e,1)}}},P=e=>($("data-v-b054c39d"),e=e(),q(),e),Y=P((()=>z("div",{class:"common-form"},"修改优惠券",-1))),M=P((()=>z("div",{class:"tips"},"例如：满100减10",-1))),S={key:0},E={key:1},O=P((()=>z("div",{class:"tips"},"折扣率范围0-10，9.5代表9.5折，0代表不折扣",-1))),T={key:2},X={key:3},Q=P((()=>z("div",{class:"tips"},"限制领取的优惠券数量，-1为不限制",-1))),W=P((()=>z("div",{class:"tips"},"促销是指满减，等级优惠券值商品的会员等级折扣",-1))),A=P((()=>z("div",{class:"common-form"},"适用商品",-1))),B=P((()=>z("span",null,"指定商品",-1))),G=P((()=>z("span",null,"指定分类",-1))),H={alt:"",width:50},J={class:"common-button-wrapper"};const K=g(N,[["render",function(e,y,g,b,$,q){const N=l,P=a,K=o,L=t,R=d,Z=i,ee=r,le=s,ae=u,oe=p,te=m,de=c,ie=f,re=_,se=h("img-url"),ue=n;return V((v(),j("div",null,[k(de,{size:"small",ref:"form",model:$.form,"label-width":"200px"},{default:x((()=>[k(P,{modelValue:$.activeName,"onUpdate:modelValue":y[0]||(y[0]=e=>$.activeName=e),type:"card"},{default:x((()=>[k(N,{label:"基本信息",name:"1"}),k(N,{label:"适用商品",name:"2"})])),_:1},8,["modelValue"]),"1"==$.activeName?(v(),j(C,{key:0},[Y,k(L,{label:"优惠券名称",prop:"name",rules:[{required:!0,message:" "}]},{default:x((()=>[k(K,{modelValue:$.form.name,"onUpdate:modelValue":y[1]||(y[1]=e=>$.form.name=e),placeholder:"请输入优惠券名称"},null,8,["modelValue"]),M])),_:1}),k(L,{label:"优惠券颜色"},{default:x((()=>[k(Z,{modelValue:$.form.color,"onUpdate:modelValue":y[2]||(y[2]=e=>$.form.color=e)},{default:x((()=>[k(R,{label:10},{default:x((()=>[U("蓝色")])),_:1}),k(R,{label:20},{default:x((()=>[U("红色")])),_:1}),k(R,{label:30},{default:x((()=>[U("紫色")])),_:1}),k(R,{label:40},{default:x((()=>[U("黄色")])),_:1})])),_:1},8,["modelValue"])])),_:1}),k(L,{label:"优惠券类型"},{default:x((()=>[k(Z,{modelValue:$.form.coupon_type,"onUpdate:modelValue":y[3]||(y[3]=e=>$.form.coupon_type=e)},{default:x((()=>[k(R,{label:10},{default:x((()=>[U("满减券")])),_:1}),k(R,{label:20},{default:x((()=>[U("折扣券")])),_:1})])),_:1},8,["modelValue"])])),_:1}),10==$.form.coupon_type?(v(),j("div",S,[k(L,{label:"减免金额"},{default:x((()=>[k(K,{modelValue:$.form.reduce_price,"onUpdate:modelValue":y[4]||(y[4]=e=>$.form.reduce_price=e),placeholder:"请输入减免金额",type:"number"},null,8,["modelValue"])])),_:1})])):(v(),j("div",E,[k(L,{label:"折扣率 "},{default:x((()=>[k(K,{modelValue:$.form.discount,"onUpdate:modelValue":y[5]||(y[5]=e=>$.form.discount=e),placeholder:"请输入折扣率",type:"number"},null,8,["modelValue"]),O])),_:1})])),k(L,{label:"最低消费金额"},{default:x((()=>[k(K,{modelValue:$.form.min_price,"onUpdate:modelValue":y[6]||(y[6]=e=>$.form.min_price=e),placeholder:"请输入最低消费金额",type:"number"},null,8,["modelValue"])])),_:1}),k(L,{label:"到期类型"},{default:x((()=>[k(Z,{modelValue:$.form.expire_type,"onUpdate:modelValue":y[7]||(y[7]=e=>$.form.expire_type=e)},{default:x((()=>[k(R,{label:10},{default:x((()=>[U("领取后生效")])),_:1}),k(R,{label:20},{default:x((()=>[U("固定时间")])),_:1})])),_:1},8,["modelValue"])])),_:1}),10==$.form.expire_type?(v(),j("div",T,[k(L,{label:"有效天数"},{default:x((()=>[k(K,{modelValue:$.form.expire_day,"onUpdate:modelValue":y[8]||(y[8]=e=>$.form.expire_day=e),placeholder:"请输入有效天数",type:"number"},null,8,["modelValue"])])),_:1})])):(v(),j("div",X,[k(L,{label:"有效时间"},{default:x((()=>[k(ee,{modelValue:$.form.active_time,"onUpdate:modelValue":y[9]||(y[9]=e=>$.form.active_time=e),type:"daterange",align:"right","unlink-panels":"","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":$.pickerOptions0},null,8,["modelValue","picker-options"])])),_:1})])),k(L,{label:"发放总数量 ",prop:"total_num",rules:[{required:!0,message:" "}]},{default:x((()=>[k(K,{modelValue:$.form.total_num,"onUpdate:modelValue":y[10]||(y[10]=e=>$.form.total_num=e),placeholder:"请输入发放总数量",type:"number"},null,8,["modelValue"]),Q])),_:1}),k(L,{label:"是否显示在领券中心"},{default:x((()=>[k(Z,{modelValue:$.form.show_center,"onUpdate:modelValue":y[11]||(y[11]=e=>$.form.show_center=e)},{default:x((()=>[k(R,{label:1},{default:x((()=>[U("显示")])),_:1}),k(R,{label:0},{default:x((()=>[U("不显示")])),_:1})])),_:1},8,["modelValue"])])),_:1}),k(L,{label:"使用条件"},{default:x((()=>[k(Z,{modelValue:$.form.free_limit,"onUpdate:modelValue":y[12]||(y[12]=e=>$.form.free_limit=e)},{default:x((()=>[k(R,{label:0},{default:x((()=>[U("不限制")])),_:1}),k(R,{label:1},{default:x((()=>[U("不可与促销同时使用")])),_:1}),k(R,{label:2},{default:x((()=>[U("不可与等级优惠同时使用")])),_:1}),k(R,{label:3},{default:x((()=>[U("不可于促销和等级优惠同时使用")])),_:1})])),_:1},8,["modelValue"]),W])),_:1}),k(L,{label:"排序"},{default:x((()=>[k(K,{type:"number",modelValue:$.form.sort,"onUpdate:modelValue":y[13]||(y[13]=e=>$.form.sort=e),placeholder:"请输入排序"},null,8,["modelValue"])])),_:1})],64)):w("",!0),"2"==$.activeName?(v(),j(C,{key:1},[A,k(L,{label:"选择"},{default:x((()=>[k(Z,{modelValue:$.form.apply_range,"onUpdate:modelValue":y[14]||(y[14]=e=>$.form.apply_range=e)},{default:x((()=>[k(R,{label:10},{default:x((()=>[U("全部商品")])),_:1}),k(R,{label:20},{default:x((()=>[B])),_:1}),k(R,{label:30},{default:x((()=>[G])),_:1})])),_:1},8,["modelValue"])])),_:1}),20==$.form.apply_range?(v(),D(L,{key:0},{default:x((()=>[k(le,{class:"mb10",onClick:y[15]||(y[15]=e=>$.is_product=!0),type:"primary",plain:""},{default:x((()=>[U("添加商品 ")])),_:1}),$.product_list.length>0?(v(),D(oe,{key:0,data:$.product_list,"max-height":"400",border:"",style:{width:"100%"}},{default:x((()=>[k(ae,{prop:"product_id",label:"ID",width:"180"}),k(ae,{prop:"product_name",label:"商品名称",width:"180"}),k(ae,{prop:"image",label:"图片"},{default:x((e=>[V(z("img",H,null,512),[[se,q.hasImages(e.row.product_image)]])])),_:1}),k(ae,{label:"操作"},{default:x((e=>[k(le,{onClick:l=>q.deleteClick(e.$index),type:"text",size:"small"},{default:x((()=>[U("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])):w("",!0)])),_:1})):w("",!0),30==$.form.apply_range?(v(),D(L,{key:1,label:""},{default:x((()=>[k(le,{class:"mb10",onClick:y[16]||(y[16]=e=>$.is_category=!0),type:"primary",plain:""},{default:x((()=>[U("添加分类 ")])),_:1}),z("div",null,[$.category_list.first.length>0?(v(!0),j(C,{key:0},F($.category_list.first,((e,l)=>(v(),j("div",{key:e.category_id,class:"mr10 mb10",style:{display:"inline-block"}},[k(te,{size:"large",type:"info"},{default:x((()=>[U(I(e.parent?e.parent+"→"+e.name:e.name),1)])),_:2},1024)])))),128)):w("",!0),$.category_list.second.length>0?(v(!0),j(C,{key:1},F($.category_list.second,((e,l)=>(v(),j("div",{key:e.category_id,class:"mr10 mb10",style:{display:"inline-block"}},[k(te,{size:"large",class:"mr10 mb10",type:"info"},{default:x((()=>[U(I(e.parent?e.parent+"→"+e.name:e.name),1)])),_:2},1024)])))),128)):w("",!0)])])),_:1})):w("",!0)],64)):w("",!0),z("div",J,[k(le,{type:"info",size:"small",onClick:q.cancelFunc,loading:$.loading},{default:x((()=>[U("取消")])),_:1},8,["onClick","loading"]),k(le,{type:"primary",size:"small",onClick:q.onSubmit,loading:$.loading},{default:x((()=>[U("提交")])),_:1},8,["onClick","loading"])])])),_:1},8,["model"]),k(ie,{isproduct:$.is_product,excludeIds:$.exclude_ids,islist:!0,onCloseDialog:q.closeProductFunc},null,8,["isproduct","excludeIds","onCloseDialog"]),k(re,{is_category:$.is_category,category_list:$.category_list,onClose:q.closeCategoryFunc},null,8,["is_category","category_list","onClose"])])),[[ue,$.loading]])}],["__scopeId","data-v-b054c39d"]]);export{K as default};
