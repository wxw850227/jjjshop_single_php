import{_ as e,v as t,x as a,y as s,N as l,A as o,a as d,o as r,c,w as i,n,g as u,b as _,d as p,f as y,r as f,F as m,q as h,j as v,i as g,S as k,k as b,t as w,e as C,J as T,h as D}from"./index-024cd044.js";import{P as x}from"./uni-popup.95b83736.js";import{u as P}from"./uni-load-more.46aeda4b.js";import{p as F}from"./pay.075972ed.js";/* empty css                                                                  */const O=e({components:{Popup:x,uniLoadMore:P},data:()=>({phoneHeight:0,scrollviewHigh:0,state_active:0,topRefresh:!1,listData:[],dataType:"all",isPayPopup:!1,pay_type:20,order_id:0,last_page:0,page:1,list_rows:10,no_more:!1,loading:!0,isCodeImg:!1,codeImg:"",is_send_wx:null,mch_id:null}),computed:{loadingType(){return this.loading?1:0!=this.listData.length&&this.no_more?2:0}},onLoad(e){void 0!==e.dataType&&(this.dataType=e.dataType),"payment"==this.dataType?this.state_active=1:"received"==this.dataType?this.state_active=3:"comment"==this.dataType?this.state_active=4:"delivery"==this.dataType&&(this.state_active=2)},mounted(){this.init()},onShow(){this.page=1,this.listData=[],this.getData()},methods:{init(){let e=this;t({success(t){e.phoneHeight=t.windowHeight,a().select(".top-tabbar").boundingClientRect((t=>{let a=e.phoneHeight-t.height;e.scrollviewHigh=a})).exec()}})},stateFunc(e){let t=this;if(t.state_active!=e){switch(t.page=1,t.loading=!0,t.state_active=e,e){case 0:t.listData=[],t.dataType="all";break;case 1:t.listData=[],t.dataType="payment";break;case 2:t.listData=[],t.dataType="delivery";break;case 3:t.listData=[],t.dataType="received";break;case 4:t.listData=[],t.dataType="comment"}t.getData()}},scrolltolowerFunc(){let e=this;e.no_more||(e.page++,e.page<=e.last_page?e.getData():e.no_more=!0)},getData(){let e=this;e.loading=!0;let t=e.dataType;e._get("user.order/lists",{dataType:t,page:e.page,list_rows:e.list_rows},(function(t){e.loading=!1,e.mch_id=t.data.mch_id,e.is_send_wx=t.data.is_send_wx,e.listData=e.listData.concat(t.data.list.data),e.last_page=t.data.list.last_page,t.data.list.last_page<=1?e.no_more=!0:e.no_more=!1}))},countDown(e){let t=e-Date.now()/1e3,a=Math.floor(t/86400),s=t%86400,l=Math.floor(s/3600);s%=3600;let o=Math.floor(s/60),d=s%60;return a=this.convertTwo(a),l=this.convertTwo(l),o=this.convertTwo(o),d=this.convertTwo(d),parseInt(a)>0?parseInt(a)+"天 ":parseInt(l)+"时"+parseInt(o)+"分"+parseInt(d)+"秒"},gotoOrder(e){this.gotoPage("/pages/order/order-detail?order_id="+e)},hidePopupFunc(){this.isPayPopup=!1},payTypeFunc(e){let t=this;t.isPayPopup=!1,s({title:"加载中"}),t._post("user.order/pay",{payType:e,order_id:t.order_id,pay_source:t.getPlatform()},(function(e){F(e,t)}))},depositPay(e){this.gotoPage("/pages/order/confirm-order?order_type=retainage&order_id="+e)},onPayOrder(e){this.gotoPage("/pages/order/cashier?order_id="+e)},orderReceipt(e){let t=this;l({title:"提示",content:"您确定要收货吗?",success:function(a){a.confirm?(s({title:"正在处理"}),t._post("user.order/receipt",{order_id:e},(function(e){o(),d({title:e.msg,duration:2e3,icon:"success"}),t.listData=[],t.getData()}))):d({title:"取消收货",duration:1e3,icon:"none"})}})},cancelAdvance(e){let t=this,a=e;l({title:"提示",content:"您确定要取消吗?",success:function(e){e.confirm&&(s({title:"正在处理"}),t._get("plus.advance.Order/cancelFront",{order_id:a},(function(e){o(),d({title:"操作成功",duration:2e3,icon:"success"}),t.listData=[],t.getData()})))}})},cancelOrder(e){let t=this,a=e;l({title:"提示",content:"您确定要取消吗?",success:function(e){e.confirm&&(s({title:"正在处理"}),t._get("user.order/cancel",{order_id:a},(function(e){o(),d({title:"操作成功",duration:2e3,icon:"success"}),t.listData=[],t.getData()})))}})},nowOverTime:e=>(new Date).getTime()>=new Date(1e3*e).getTime(),gotoEvaluate(e){this.gotoPage("/pages/order/evaluate/evaluate?order_id="+e)},onQRCode(e){let t=this;s({title:"加载中"});let a=e;t._get("user.order/qrcode",{order_id:a,source:t.getPlatform()},(function(e){o(),t.isCodeImg=!0,t.codeImg=e.data.qrcode}))},hideCodePopupFunc(){this.isCodeImg=!1},gotoAssembleShare(e){let t="/pages/plus/assemble/fight-group-detail/fight-group-detail?assemble_bill_id="+e;this.gotoPage(t)},wxOrder(e){let t=this;wx.openBusinessView&&wx.openBusinessView({businessType:"weappOrderConfirm",extraData:{merchant_id:t.mch_id,merchant_trade_no:e.trade_no,transaction_id:e.transaction_id},success(){t._post("user.order/receipt",{order_id:e.order_id},(function(e){d({title:e.msg,duration:2e3,icon:"success"}),t.listData=[],t.getData()}))},fail(){},complete(){}})}}},[["render",function(e,t,a,s,l,o){const d=u,x=v,P=g,F=k,O=D,I=b("uni-load-more"),R=b("Popup"),H=b("tabBar");return r(),c(d,{"data-theme":e.theme(),class:n(e.theme()||"")},{default:i((()=>[_(d,{class:"top-tabbar"},{default:i((()=>[_(d,{class:n(0==l.state_active?"tab-item active":"tab-item"),onClick:t[0]||(t[0]=e=>o.stateFunc(0))},{default:i((()=>[p("全部订单")])),_:1},8,["class"]),_(d,{class:n(1==l.state_active?"tab-item active":"tab-item"),onClick:t[1]||(t[1]=e=>o.stateFunc(1))},{default:i((()=>[p("待付款")])),_:1},8,["class"]),_(d,{class:n(2==l.state_active?"tab-item active":"tab-item"),onClick:t[2]||(t[2]=e=>o.stateFunc(2))},{default:i((()=>[p("待发货")])),_:1},8,["class"]),_(d,{class:n(3==l.state_active?"tab-item active":"tab-item"),onClick:t[3]||(t[3]=e=>o.stateFunc(3))},{default:i((()=>[p("待收货")])),_:1},8,["class"]),_(d,{class:n(4==l.state_active?"tab-item active":"tab-item"),onClick:t[4]||(t[4]=e=>o.stateFunc(4))},{default:i((()=>[p("待评价")])),_:1},8,["class"])])),_:1}),_(F,{"scroll-y":"true",class:"scroll-Y",style:h("height:"+l.scrollviewHigh+"px;"),"lower-threshold":"50",onScrolltolower:o.scrolltolowerFunc},{default:i((()=>[_(d,{class:n(l.topRefresh?"top-refresh open":"top-refresh")},{default:i((()=>[(r(),y(m,null,f(3,((e,t)=>_(d,{class:"circle",key:t}))),64))])),_:1},8,["class"]),_(d,{class:"order-list"},{default:i((()=>[(r(!0),y(m,null,f(l.listData,((t,a)=>(r(),c(d,{class:"item",key:a},{default:i((()=>[_(d,{class:"order-head d-b-c"},{default:i((()=>[_(d,null,{default:i((()=>[_(x,{class:"state-text"},{default:i((()=>[p(w(t.order_source_text),1)])),_:2},1024),_(x,{class:"shop-name flex-1 fb"},{default:i((()=>[p("订单号："+w(t.order_no),1)])),_:2},1024)])),_:2},1024),_(d,{class:"state"},{default:i((()=>[_(x,{class:"red"},{default:i((()=>[p(w(t.state_text),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),t.product.length>1?(r(),c(d,{key:0,class:"product-list pr",onClick:e=>o.gotoOrder(t.order_id)},{default:i((()=>[_(F,{"scroll-x":"true"},{default:i((()=>[_(d,{class:"list d-s-c pr100"},{default:i((()=>[(r(!0),y(m,null,f(t.product,((e,t)=>(r(),c(d,{class:"cover mr10",key:t},{default:i((()=>[_(P,{src:e.image.file_path,mode:"aspectFit"},null,8,["src"])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024),_(d,{class:"total-count"},{default:i((()=>[_(d,{class:"left-shadow"}),_(d,{class:"price f22 theme-price"},{default:i((()=>[p(" ¥ "),_(x,{class:"f40 theme-price"},{default:i((()=>[p(w(t.pay_price),1)])),_:2},1024)])),_:2},1024),_(d,{class:"count"},{default:i((()=>[p("共"+w(t.product.length)+"件",1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])):(r(),c(d,{key:1,class:"one-product d-s-c",onClick:e=>o.gotoOrder(t.order_id)},{default:i((()=>[(r(!0),y(m,null,f(t.product,((e,t)=>(r(),c(d,{class:"cover",key:t},{default:i((()=>[_(P,{src:e.image.file_path,mode:"aspectFit"},null,8,["src"])])),_:2},1024)))),128)),_(d,{class:"pro-info flex-1"},{default:i((()=>[p(w(t.product[0].product_name),1)])),_:2},1024),_(d,{class:"total-count"},{default:i((()=>[_(d,{class:"left-shadow"}),_(d,{class:"price theme-price f22"},{default:i((()=>[p(" ¥ "),80==t.order_source?(r(),c(x,{key:0,class:"f40 theme-price"},{default:i((()=>[p(w((1*t.pay_price+1*t.advance.pay_price).toFixed(2)),1)])),_:2},1024)):(r(),c(x,{key:1,class:"f40 theme-price"},{default:i((()=>[p(w(t.pay_price),1)])),_:2},1024))])),_:2},1024),_(d,{class:"count"},{default:i((()=>[p("共"+w(t.product[0].total_num)+"件",1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])),80==t.order_source?(r(),c(d,{key:2,class:"order-bts presale"},{default:i((()=>[_(d,{class:"d-b-c line-h-50 f24 gray9"},{default:i((()=>[_(d,null,{default:i((()=>[p("定金")])),_:1}),_(d,null,{default:i((()=>[_(x,null,{default:i((()=>[p(w(20==t.advance.pay_status.value?"已支付":"待支付"),1)])),_:2},1024),p("￥"+w(t.advance.pay_price),1)])),_:2},1024)])),_:2},1024),_(d,{class:"d-b-c line-h-50 f24 gray9"},{default:i((()=>[_(d,null,{default:i((()=>[p("尾款")])),_:1}),_(d,null,{default:i((()=>[_(x,null,{default:i((()=>[p(w(20==t.advance.pay_status.value&&20==t.pay_status.value?"已支付":"待支付"),1)])),_:2},1024),p(" ￥"+w(t.pay_price),1)])),_:2},1024)])),_:2},1024),10==t.order_status.value?(r(),y(m,{key:0},[t.advance&&20==t.advance.pay_status.value?(r(),c(d,{key:0,class:"d-e-c line-h-50 f24 gray9"},{default:i((()=>[o.nowOverTime(t.advance.end_time)&&t.pay_end_time_format?(r(),c(d,{key:0},{default:i((()=>[p(" 尾款支付截止时间:"),_(x,{class:"redF11"},{default:i((()=>[p(w(t.pay_end_time_format),1)])),_:2},1024)])),_:2},1024)):t.advance.end_time_text?(r(),c(d,{key:1},{default:i((()=>[p(" 尾款支付时间:"),_(x,{class:"redF11"},{default:i((()=>[p(w(t.advance.end_time_text),1)])),_:2},1024)])),_:2},1024)):C("",!0)])),_:2},1024)):C("",!0)],64)):C("",!0),T("template",null,[10==t.advance.pay_status.value&&10==t.advance.order_status?(r(),c(d,{key:0,class:"d-e-c line-h-50 f24 gray9"},{default:i((()=>[o.nowOverTime(t.advance.pay_end_time)||o.nowOverTime(t.advance.end_time)?C("",!0):(r(),c(d,{key:0},{default:i((()=>[p(" 定金支付截止时间: "),_(x,{class:"redF11"},{default:i((()=>[p(w(o.countDown(t.advance.pay_end_time)),1)])),_:2},1024)])),_:2},1024))])),_:2},1024)):C("",!0)]),21!=t.order_status.value?(r(),c(d,{key:1,class:"d-e-c"},{default:i((()=>[20==t.advance.pay_status.value&&10==t.pay_status.value?(r(),y(m,{key:0},[o.nowOverTime(t.advance.end_time)&&20!=t.order_status.value?(r(),y(m,{key:0},[t.advance.main_order_no!=t.order_no?(r(),c(d,{key:0,class:"d-e-c mt10"},{default:i((()=>[_(O,{class:"pay-btn theme-btn",onClick:a=>e.gotoPage("/pages/order/cashier?order_id="+t.order_id)},{default:i((()=>[p("支付尾款")])),_:2},1032,["onClick"])])),_:2},1024)):(r(),c(d,{key:1,class:"d-e-c mt10"},{default:i((()=>[_(O,{class:"pay-btn theme-btn",onClick:e=>o.depositPay(t.order_id)},{default:i((()=>[p("支付尾款")])),_:2},1032,["onClick"])])),_:2},1024))],64)):C("",!0)],64)):C("",!0),10==t.pay_status.value&&10==t.advance.order_status&&1==t.advance.money_return?(r(),c(d,{key:1,class:"d-e-c mt10"},{default:i((()=>[_(O,{class:"pay-btn theme-borderbtn",onClick:e=>o.cancelAdvance(t.advance.order_advance_id)},{default:i((()=>[p("取消定金")])),_:2},1032,["onClick"])])),_:2},1024)):C("",!0),10==t.order_status.value&&20==t.pay_status.value?(r(),y(m,{key:2},[10==t.delivery_status.value?(r(),c(O,{key:0,onClick:e=>o.cancelOrder(t.order_id),class:"theme-borderbtn"},{default:i((()=>[p("申请取消")])),_:2},1032,["onClick"])):C("",!0)],64)):C("",!0),10!=t.advance.pay_status.value||20==t.order_status.value||o.nowOverTime(t.advance.pay_end_time)?C("",!0):(r(),c(d,{key:3,class:"d-e-c mt10"},{default:i((()=>[_(O,{class:"pay-btn theme-btn",onClick:a=>e.gotoPage("/pages/order/cashier?order_type=40&order_id="+t.advance.order_advance_id)},{default:i((()=>[p("支付定金 ")])),_:2},1032,["onClick"])])),_:2},1024)),20==t.delivery_status.value&&10==t.receipt_status.value?(r(),c(d,{key:4,class:"d-e-c mt10"},{default:i((()=>[_(O,{class:"pay-btn theme-btn",onClick:e=>o.orderReceipt(t.order_id)},{default:i((()=>[p("确认收货 ")])),_:2},1032,["onClick"])])),_:2},1024)):C("",!0),30==t.order_status.value&&0==t.is_comment?(r(),c(d,{key:5,class:"d-e-c mt10"},{default:i((()=>[_(O,{class:"pay-btn theme-btn",onClick:e=>o.gotoEvaluate(t.order_id)},{default:i((()=>[p("评价 ")])),_:2},1032,["onClick"])])),_:2},1024)):C("",!0)])),_:2},1024)):(r(),c(d,{key:2,class:"count d-e-c ww100 redF11"},{default:i((()=>[p("取消申请中")])),_:1}))])),_:2},1024)):(r(),c(d,{key:3,class:"order-bts"},{default:i((()=>[10==t.order_status.value?(r(),y(m,{key:0},[10==t.pay_status.value?(r(),c(O,{key:0,onClick:e=>o.cancelOrder(t.order_id),class:"theme-borderbtn"},{default:i((()=>[p("取消")])),_:2},1032,["onClick"])):C("",!0),20==t.pay_status.value&&10==t.delivery_status.value?(r(),c(O,{key:1,onClick:e=>o.cancelOrder(t.order_id),class:"theme-borderbtn"},{default:i((()=>[p("申请取消")])),_:2},1032,["onClick"])):C("",!0),20==t.pay_status.value&&20==t.delivery_type.value&&10==t.delivery_status.value?(r(),y(m,{key:2},[30==t.order_source&&20==t.assemble_status?(r(),c(O,{key:0,onClick:e=>o.onQRCode(t.order_id),class:"theme-borderbtn"},{default:i((()=>[p("核销码")])),_:2},1032,["onClick"])):C("",!0),30!=t.order_source?(r(),c(O,{key:1,onClick:e=>o.onQRCode(t.order_id),class:"theme-borderbtn"},{default:i((()=>[p("核销码")])),_:2},1032,["onClick"])):C("",!0)],64)):C("",!0),10==t.pay_status.value?(r(),c(O,{key:3,class:"theme-btn",onClick:e=>o.onPayOrder(t.order_id)},{default:i((()=>[p("付款")])),_:2},1032,["onClick"])):C("",!0),20==t.delivery_status.value&&10==t.receipt_status.value?(r(),y(m,{key:4},[20==t.pay_type.value&&"wx"==t.pay_source&&l.is_send_wx?(r(),c(O,{key:0,class:"theme-btn",onClick:e=>o.wxOrder(t)},{default:i((()=>[p("确认收货")])),_:2},1032,["onClick"])):(r(),c(O,{key:1,class:"theme-btn",onClick:e=>o.orderReceipt(t.order_id)},{default:i((()=>[p("确认收货")])),_:2},1032,["onClick"]))],64)):C("",!0)],64)):C("",!0),21==t.order_status.value?(r(),c(x,{key:1,class:"count"},{default:i((()=>[p("取消申请中")])),_:1})):C("",!0),30==t.order_status.value&&0==t.is_comment?(r(),c(O,{key:2,class:"theme-btn",onClick:e=>o.gotoEvaluate(t.order_id)},{default:i((()=>[p("评价")])),_:2},1032,["onClick"])):C("",!0),10==t.assemble_status&&30==t.order_source?(r(),c(O,{key:3,class:"theme-btn",onClick:e=>o.gotoAssembleShare(t.product[0].bill_source_id)},{default:i((()=>[p("邀请好友拼单")])),_:2},1032,["onClick"])):C("",!0)])),_:2},1024))])),_:2},1024)))),128)),0!=l.listData.length||l.loading?(r(),c(I,{key:1,loadingType:o.loadingType},null,8,["loadingType"])):(r(),c(d,{key:0,class:"d-c-c p30"},{default:i((()=>[_(x,{class:"iconfont icon-wushuju"}),_(x,{class:"cont"},{default:i((()=>[p("亲，暂无相关记录哦")])),_:1})])),_:1}))])),_:1})])),_:1},8,["style","onScrolltolower"]),_(R,{show:l.isCodeImg,type:"middle",onHidePopup:o.hideCodePopupFunc},{default:i((()=>[_(d,{class:"ww100 p20 box-s-b"},{default:i((()=>[_(P,{class:"ww100",src:l.codeImg,mode:"widthFix"},null,8,["src"])])),_:1})])),_:1},8,["show","onHidePopup"]),_(H)])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-8cde07c5"]]);export{O as default};
