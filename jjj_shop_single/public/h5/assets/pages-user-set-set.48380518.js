import{_ as e,y as a,A as t,ag as s,z as o,ad as n,N as l,o as i,c as u,w as c,n as d,g as p,b as r,d as f,t as m,e as g,j as h,i as _,I as b,h as k,a2 as w,k as y}from"./index-024cd044.js";import I from"./components-upload-upload.13e9c905.js";import{P as N}from"./uni-popup.95b83736.js";/* empty css                                                                  */const v=e({components:{Upload:I,Popup:N},data:()=>({userInfo:{},isUpload:!1,isPopup:!1,newName:"",type:"",version_no:"",imageList:[]}),onShow(){this.getData()},methods:{onChooseAvatar(e){console.log(e),this.uploadFile([e.detail.avatarUrl])},getData(){let e=this;a({title:"加载中"}),e._get("user.index/setting",{},(function(a){e.userInfo=a.data.userInfo,t()}))},gotoBind(){this.gotoPage("/pages/user/modify-phone/modify-phone")},logout(){s("token"),s("user_id"),this.gotoPage("/pages/index/index")},changeName(e){let a=this;"mobile"==e&&(a.oldmobile=a.userInfo.mobile),a.type=e,a.newName=a.userInfo[e],a.isPopup=!0},hidePopupFunc(){this.newName="",this.isPopup=!1},changeinput(e){this.newName=e.detail.value},clearName(){this.newName=""},subName(e){let a=this;a.loading||(a.newName=e.detail.value.newName,console.log(e.detail.value.newName),a.userInfo[a.type]=this.newName,a.update())},changeAvatarUrl(){this.isUpload=!0},uploadFile:function(e){let s=this,l=0,i=e.length,u={token:o("token"),app_id:s.getAppId()};a({title:"图片上传中"}),e.forEach((function(e,a){n({url:s.websiteUrl+"/index.php?s=/api/file.upload/image",filePath:e,name:"iFile",formData:u,success:function(e){let a="object"==typeof e.data?e.data:JSON.parse(e.data);1===a.code?s.imageList.push(a.data):s.showError(a.msg)},complete:function(){l++,i===l&&(t(),s.getImgsFunc(s.imageList))}})}))},getImgsFunc(e){if(this.isUpload=!1,e&&void 0!==e){let a=this;a.userInfo.avatarUrl=e[0].file_path,a.update()}},update(){let e=this;if(e.loading)return;a({title:"加载中"});let s=e.userInfo;e.loading=!0,e._post("user.user/updateInfo",s,(function(a){e.showSuccess("修改成功",(function(){e.loading=!1,e.isPopup=!1,t(),e.getData()}),(function(a){t(),e.loading=!1,e.isPopup=!1}))}))},deleteAccount(){let e=this;l({title:"提示",content:"是否确认删除账号？删除后您将无法用此账号登录，此账户下的数据也将删除",success:function(a){a.confirm&&e._post("user.user/deleteAccount",{},(a=>{e.showSuccess("删除成功",(()=>{s("token"),s("user_id"),e.gotoPage("/pages/index/index")}))}),!1,(()=>{t()}))}})}}},[["render",function(e,a,t,s,o,n){const l=h,I=_,N=p,v=b,P=k,U=w,x=y("Popup"),C=y("Upload");return i(),u(N,{class:d(["address-form",e.theme()||""]),"data-theme":e.theme()},{default:c((()=>[r(N,{class:"bg-white p-0-30 f30"},{default:c((()=>[r(N,{class:"d-b-c border-b info-item avatar"},{default:c((()=>[r(l,{class:"key-name"},{default:c((()=>[f("头像")])),_:1}),r(N,{class:"d-e-c",onClick:n.changeAvatarUrl},{default:c((()=>[r(N,{class:"info-image"},{default:c((()=>[r(I,{src:o.userInfo.avatarUrl||"/static/default.png",mode:""},null,8,["src"])])),_:1}),r(l,{class:"icon iconfont icon-jiantou"})])),_:1},8,["onClick"])])),_:1}),r(N,{class:"d-b-c p-30-0 border-b"},{default:c((()=>[r(l,{class:"key-name"},{default:c((()=>[f("会员ID")])),_:1}),r(N,{class:"d-e-c"},{default:c((()=>[r(l,{class:"mr20"},{default:c((()=>[f(m(o.userInfo.user_id),1)])),_:1})])),_:1})])),_:1}),r(N,{class:"d-b-c p-30-0 border-b"},{default:c((()=>[r(l,{class:"key-name"},{default:c((()=>[f("昵称")])),_:1}),r(N,{class:"d-e-c",onClick:a[0]||(a[0]=e=>n.changeName("nickName"))},{default:c((()=>[r(l,{class:"mr20"},{default:c((()=>[f(m(o.userInfo.nickName),1)])),_:1}),r(l,{class:"icon iconfont icon-jiantou"})])),_:1})])),_:1}),r(N,{class:"d-b-c p-30-0"},{default:c((()=>[r(l,{class:"key-name"},{default:c((()=>[f("手机号码")])),_:1}),o.userInfo.mobile?(i(),u(N,{key:0,class:"d-e-c"},{default:c((()=>[r(l,{class:"mr20"},{default:c((()=>[f(m(o.userInfo.mobile),1)])),_:1})])),_:1})):g("",!0),o.userInfo.mobile?g("",!0):(i(),u(N,{key:1,class:"d-e-c",onClick:n.gotoBind},{default:c((()=>[r(l,{class:"mr20"},{default:c((()=>[f("未绑定")])),_:1}),r(l,{class:"iconfont icon-jiantou"})])),_:1},8,["onClick"]))])),_:1}),r(N,{class:"setup-btn theme-btn",onClick:a[1]||(a[1]=e=>n.logout())},{default:c((()=>[f("退出登录")])),_:1})])),_:1}),r(x,{show:o.isPopup,type:"bottom",width:750,padding:0,onHidePopup:n.hidePopupFunc},{default:c((()=>[r(U,{onSubmit:n.subName},{default:c((()=>[r(N,{class:"d-s-s d-c p20 mpservice-wrap"},{default:c((()=>[r(N,{class:"tc f32 fb ww100"},{default:c((()=>[f("修改")])),_:1}),"mobile"==o.type||"nickName"==o.type||"user_name"==o.type||"email"==o.type||"idcard"==o.type?(i(),u(N,{key:0,class:"pop-input d-b-c"},{default:c((()=>[r(v,{type:"text",name:"newName",class:"flex-1",placeholder:"请输入",value:o.newName,onInput:n.changeinput},null,8,["value","onInput"]),r(N,{class:"icon-guanbi icon iconfont",onClick:n.clearName},null,8,["onClick"])])),_:1})):g("",!0),r(N,{class:"d-a-c ww100"},{default:c((()=>[r(P,{class:"btn-gray-border",onClick:n.hidePopupFunc},{default:c((()=>[f("取消")])),_:1},8,["onClick"]),r(P,{class:"theme-btn","form-type":"submit"},{default:c((()=>[f("确认")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1},8,["show","onHidePopup"]),o.isUpload?(i(),u(C,{key:0,num:1,onGetImgs:n.getImgsFunc},null,8,["onGetImgs"])):g("",!0)])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-a9985619"]]);export{v as default};
